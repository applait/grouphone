/*
 * mediasoup-client v2.0.12
 * mediasoup client side JavaScript SDK
 * https://mediasoup.org
 * Copyright © 2017, Iñaki Baz Castillo <ibc@aliax.net>
 * License: ISC
 */

!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).mediasoupClient=e()}}(function(){return function(){return function e(t,r,n){function o(i,s){if(!r[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(a)return a(i,!0);var u=new Error("Cannot find module '"+i+"'");throw u.code="MODULE_NOT_FOUND",u}var d=r[i]={exports:{}};t[i][0].call(d.exports,function(e){var r=t[i][1][e];return o(r||e)},d,d.exports,e,t,r,n)}return r[i].exports}for(var a="function"==typeof require&&require,i=0;i<n.length;i++)o(n[i]);return o}}()({1:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("events"),i=e("./Logger"),s=(n=i)&&n.__esModule?n:{default:n},c=e("./errors");var u=new s.default("CommandQueue"),d=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setMaxListeners(1/0),e._closed=!1,e._busy=!1,e._queue=[],e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.EventEmitter),o(t,[{key:"close",value:function(){this._closed=!0}},{key:"push",value:function(e,t){var r=this,n=Object.assign({method:e},t);return u.debug("push() [method:%s]",e),new Promise(function(e,t){var o=r._queue;n.resolve=e,n.reject=t,o.push(n),r._handlePendingCommands()})}},{key:"_handlePendingCommands",value:function(){var e=this;if(!this._busy){var t=this._queue,r=t[0];r&&(this._busy=!0,this._handleCommand(r).then(function(){e._busy=!1,t.shift(),e._handlePendingCommands()}))}}},{key:"_handleCommand",value:function(e){var t=this;if(u.debug("_handleCommand() [method:%s]",e.method),this._closed)return e.reject(new c.InvalidStateError("closed")),Promise.resolve();var r={promise:null};return this.emit("exec",e,r),Promise.resolve().then(function(){return r.promise}).then(function(r){u.debug("_handleCommand() | command succeeded [method:%s]",e.method),t._closed?e.reject(new c.InvalidStateError("closed")):e.resolve(r)}).catch(function(t){u.error("_handleCommand() | command failed [method:%s]: %o",e.method,t),e.reject(t)})}}]),t}();r.default=d},{"./Logger":5,"./errors":10,events:28}],2:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=c(e("./Logger")),i=c(e("./EnhancedEventEmitter")),s=e("./errors");function c(e){return e&&e.__esModule?e:{default:e}}var u=new Set(["default","low","medium","high"]),d=1e3,l=new a.default("Consumer"),p=function(e){function t(e,r,n,o,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,l));return i._id=e,i._closed=!1,i._kind=r,i._rtpParameters=n,i._peer=o,i._appData=a,i._supported=!1,i._transport=null,i._track=null,i._locallyPaused=!1,i._remotelyPaused=!1,i._statsEnabled=!1,i._statsInterval=d,i._preferredProfile="default",i._effectiveProfile=null,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),o(t,[{key:"close",value:function(){l.debug("close()"),this._closed||(this._closed=!0,this._statsEnabled&&(this._statsEnabled=!1,this.transport&&this.transport.disableConsumerStats(this)),this.emit("@close"),this.safeEmit("close","local"),this._destroy())}},{key:"remoteClose",value:function(){l.debug("remoteClose()"),this._closed||(this._closed=!0,this._transport&&this._transport.removeConsumer(this),this._destroy(),this.emit("@close"),this.safeEmit("close","remote"))}},{key:"_destroy",value:function(){this._transport=null;try{this._track.stop()}catch(e){}this._track=null}},{key:"receive",value:function(e){var t=this;return l.debug("receive() [transport:%o]",e),this._closed?Promise.reject(new s.InvalidStateError("Consumer closed")):this._supported?this._transport?Promise.reject(new Error("already handled by a Transport")):"object"!==(void 0===e?"undefined":n(e))?Promise.reject(new TypeError("invalid Transport")):(this._transport=e,e.addConsumer(this).then(function(r){return t._track=r,t.paused&&(r.enabled=!1),e.once("@close",function(){if(!t._closed&&t._transport===e){t._transport=null;try{t._track.stop()}catch(e){}t._track=null,t.safeEmit("unhandled")}}),t.safeEmit("handled"),t._statsEnabled&&e.enableConsumerStats(t,t._statsInterval),r}).catch(function(e){throw t._transport=null,e})):Promise.reject(new Error("unsupported codecs"))}},{key:"pause",value:function(e){return l.debug("pause()"),this._closed?(l.error("pause() | Consumer closed"),!1):!!this._locallyPaused||(this._locallyPaused=!0,this._track&&(this._track.enabled=!1),this._transport&&this._transport.pauseConsumer(this,e),this.safeEmit("pause","local",e),this.paused)}},{key:"remotePause",value:function(e){l.debug("remotePause()"),this._closed||this._remotelyPaused||(this._remotelyPaused=!0,this._track&&(this._track.enabled=!1),this.safeEmit("pause","remote",e))}},{key:"resume",value:function(e){return l.debug("resume()"),this._closed?(l.error("resume() | Consumer closed"),!1):!this._locallyPaused||(this._locallyPaused=!1,this._track&&!this._remotelyPaused&&(this._track.enabled=!0),this._transport&&this._transport.resumeConsumer(this,e),this.safeEmit("resume","local",e),!this.paused)}},{key:"remoteResume",value:function(e){l.debug("remoteResume()"),!this._closed&&this._remotelyPaused&&(this._remotelyPaused=!1,this._track&&!this._locallyPaused&&(this._track.enabled=!0),this.safeEmit("resume","remote",e))}},{key:"setPreferredProfile",value:function(e){l.debug("setPreferredProfile() [profile:%s]",e),this._closed?l.error("setPreferredProfile() | Consumer closed"):e!==this._preferredProfile&&(u.has(e)?(this._preferredProfile=e,this._transport&&this._transport.setConsumerPreferredProfile(this,this._preferredProfile)):l.error('setPreferredProfile() | invalid profile "%s"',e))}},{key:"remoteSetPreferredProfile",value:function(e){l.debug("remoteSetPreferredProfile() [profile:%s]",e),this._closed||e===this._preferredProfile||(this._preferredProfile=e)}},{key:"remoteEffectiveProfileChanged",value:function(e){l.debug("remoteEffectiveProfileChanged() [profile:%s]",e),this._closed||e===this._effectiveProfile||(this._effectiveProfile=e,this.safeEmit("effectiveprofilechange",this._effectiveProfile))}},{key:"enableStats",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d;l.debug("enableStats() [interval:%s]",e),this._closed?l.error("enableStats() | Consumer closed"):this._statsEnabled||(this._statsInterval="number"!=typeof e||e<1e3?d:e,this._statsEnabled=!0,this._transport&&this._transport.enableConsumerStats(this,this._statsInterval))}},{key:"disableStats",value:function(){l.debug("disableStats()"),this._closed?l.error("disableStats() | Consumer closed"):this._statsEnabled&&(this._statsEnabled=!1,this._transport&&this._transport.disableConsumerStats(this))}},{key:"setSupported",value:function(e){this._supported=e}},{key:"remoteStats",value:function(e){this.safeEmit("stats",e)}},{key:"id",get:function(){return this._id}},{key:"closed",get:function(){return this._closed}},{key:"kind",get:function(){return this._kind}},{key:"rtpParameters",get:function(){return this._rtpParameters}},{key:"peer",get:function(){return this._peer}},{key:"appData",get:function(){return this._appData}},{key:"supported",get:function(){return this._supported}},{key:"transport",get:function(){return this._transport}},{key:"track",get:function(){return this._track}},{key:"locallyPaused",get:function(){return this._locallyPaused}},{key:"remotelyPaused",get:function(){return this._remotelyPaused}},{key:"paused",get:function(){return this._locallyPaused||this._remotelyPaused}},{key:"preferredProfile",get:function(){return this._preferredProfile}},{key:"effectiveProfile",get:function(){return this._effectiveProfile}}]),t}();r.default=p},{"./EnhancedEventEmitter":4,"./Logger":5,"./errors":10}],3:[function(e,t,r){(function(t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=l(e("bowser")),a=l(e("./Logger")),i=l(e("./handlers/Chrome55")),s=l(e("./handlers/Safari11")),c=l(e("./handlers/Firefox50")),u=l(e("./handlers/Edge11")),d=l(e("./handlers/ReactNative"));function l(e){return e&&e.__esModule?e:{default:e}}var p=new a.default("Device"),f=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,null,[{key:"getFlag",value:function(){return e._detected||e._detect(),e._flag}},{key:"getName",value:function(){return e._detected||e._detect(),e._name}},{key:"getVersion",value:function(){return e._detected||e._detect(),e._version}},{key:"getBowser",value:function(){return e._detected||e._detect(),e._bowser}},{key:"isSupported",value:function(){return e._detected||e._detect(),Boolean(e._handlerClass)}},{key:"_detect",value:function(){if(e._detected=!0,t.navigator&&"ReactNative"===t.navigator.product)e._flag="react-native",e._name="ReactNative",e._version=void 0,e._bowser={},e._handlerClass=d.default;else if(t.navigator&&"string"==typeof t.navigator.userAgent){var r=t.navigator.userAgent,n=o.default.detect(r);e._flag=void 0,e._name=n.name||void 0,e._version=n.version||void 0,e._bowser=n,e._handlerClass=null,o.default.check({chrome:"55",chromium:"55"},!0,r)?(e._flag="chrome",e._handlerClass=i.default):o.default.check({firefox:"50"},!0,r)?(e._flag="firefox",e._handlerClass=c.default):o.default.check({safari:"11"},!0,r)?(e._flag="safari",e._handlerClass=s.default):o.default.check({msedge:"11"},!0,r)&&(e._flag="msedge",e._handlerClass=u.default),o.default.check({opera:"44"},!0,r)&&(e._flag="opera",e._handlerClass=i.default),e.isSupported()?p.debug('browser supported [flag:%s, name:"%s", version:%s, handler:%s]',e._flag,e._name,e._version,e._handlerClass.tag):p.warn("browser not supported [name:%s, version:%s]",e._name,e._version)}else p.warn("device not supported")}},{key:"Handler",get:function(){return e._detected||e._detect(),e._handlerClass}}]),e}();r.default=f,f._detected=!1,f._flag=void 0,f._name=void 0,f._version=void 0,f._bowser=void 0,f._handlerClass=null}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Logger":5,"./handlers/Chrome55":11,"./handlers/Edge11":12,"./handlers/Firefox50":13,"./handlers/ReactNative":14,"./handlers/Safari11":15,bowser:25}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("events"),i=e("./Logger"),s=(n=i)&&n.__esModule?n:{default:n};var c=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.setMaxListeners(1/0),r._logger=e||new s.default("EnhancedEventEmitter"),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.EventEmitter),o(t,[{key:"safeEmit",value:function(e){try{for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.emit.apply(this,[e].concat(r))}catch(t){this._logger.error("safeEmit() | event listener threw an error [event:%s]:%o",e,t)}}},{key:"safeEmitAsPromise",value:function(e){for(var t=this,r=arguments.length,n=Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];return new Promise(function(r,o){t.safeEmit.apply(t,[e].concat(n,[function(e){r(e)},function(r){t._logger.error("safeEmitAsPromise() | errback called [event:%s]:%o",e,r),o(r)}]))})}}]),t}();r.default=c},{"./Logger":5,events:28}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("debug"),i=(n=a)&&n.__esModule?n:{default:n};var s="mediasoup-client",c=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t?(this._debug=(0,i.default)(s+":"+t),this._warn=(0,i.default)(s+":WARN:"+t),this._error=(0,i.default)(s+":ERROR:"+t)):(this._debug=(0,i.default)(s),this._warn=(0,i.default)(s+":WARN"),this._error=(0,i.default)(s+":ERROR")),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}return o(e,[{key:"debug",get:function(){return this._debug}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}]),e}();r.default=c},{debug:26}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=i(e("./Logger")),a=i(e("./EnhancedEventEmitter"));function i(e){return e&&e.__esModule?e:{default:e}}var s=new o.default("Peer"),c=function(e){function t(e,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,s));return n._name=e,n._closed=!1,n._appData=r,n._consumers=new Map,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),n(t,[{key:"close",value:function(){if(s.debug("close()"),!this._closed){this._closed=!0,this.emit("@close"),this.safeEmit("close","local");var e=!0,t=!1,r=void 0;try{for(var n,o=this._consumers.values()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.close()}}catch(e){t=!0,r=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw r}}}}},{key:"remoteClose",value:function(e){if(s.debug("remoteClose()"),!this._closed){this._closed=!0,this.emit("@close"),this.safeEmit("close","remote",e);var t=!0,r=!1,n=void 0;try{for(var o,a=this._consumers.values()[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){o.value.remoteClose()}}catch(e){r=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(r)throw n}}}}},{key:"getConsumerById",value:function(e){return this._consumers.get(e)}},{key:"addConsumer",value:function(e){var t=this;if(this._consumers.has(e.id))throw new Error("Consumer already exists [id:"+e.id+"]");this._consumers.set(e.id,e),e.on("@close",function(){t._consumers.delete(e.id)}),this.safeEmit("newconsumer",e)}},{key:"name",get:function(){return this._name}},{key:"closed",get:function(){return this._closed}},{key:"appData",get:function(){return this._appData}},{key:"consumers",get:function(){return Array.from(this._consumers.values())}}]),t}();r.default=c},{"./EnhancedEventEmitter":4,"./Logger":5}],7:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=u(e("./Logger")),i=u(e("./EnhancedEventEmitter")),s=e("./errors"),c=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}}(e("./utils"));function u(e){return e&&e.__esModule?e:{default:e}}var d=1e3,l={low:1e5,medium:3e5,high:15e5},p=new a.default("Producer"),f=function(e){function t(e,r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,p));a._id=c.randomNumber(),a._closed=!1,a._originalTrack=e;try{a._track=e.clone()}catch(t){a._track=e}return a._appData=o,a._simulcast=!1,"object"===n(r.simulcast)?a._simulcast=Object.assign({},l,r.simulcast):!0===r.simulcast&&(a._simulcast=Object.assign({},l)),a._transport=null,a._rtpParameters=null,a._locallyPaused=!a._track.enabled,a._remotelyPaused=!1,a._statsEnabled=!1,a._statsInterval=d,a._handleTrack(),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),o(t,[{key:"close",value:function(e){p.debug("close()"),this._closed||(this._closed=!0,this._statsEnabled&&(this._statsEnabled=!1,this.transport&&this.transport.disableProducerStats(this)),this._transport&&this._transport.removeProducer(this,"local",e),this._destroy(),this.emit("@close","local",e),this.safeEmit("close","local",e))}},{key:"remoteClose",value:function(e){p.debug("remoteClose()"),this._closed||(this._closed=!0,this._transport&&this._transport.removeProducer(this,"remote",e),this._destroy(),this.emit("@close","remote",e),this.safeEmit("close","remote",e))}},{key:"_destroy",value:function(){this._transport=!1,this._rtpParameters=null;try{this._track.stop()}catch(e){}}},{key:"send",value:function(e){var t=this;return p.debug("send() [transport:%o]",e),this._closed?Promise.reject(new s.InvalidStateError("Producer closed")):this._transport?Promise.reject(new Error("already handled by a Transport")):"object"!==(void 0===e?"undefined":n(e))?Promise.reject(new TypeError("invalid Transport")):(this._transport=e,e.addProducer(this).then(function(){e.once("@close",function(){t._closed||t._transport!==e||(t._transport.removeProducer(t,"local"),t._transport=null,t._rtpParameters=null,t.safeEmit("unhandled"))}),t.safeEmit("handled"),t._statsEnabled&&e.enableProducerStats(t,t._statsInterval)}).catch(function(e){throw t._transport=null,e}))}},{key:"pause",value:function(e){return p.debug("pause()"),this._closed?(p.error("pause() | Producer closed"),!1):!!this._locallyPaused||(this._locallyPaused=!0,this._track.enabled=!1,this._transport&&this._transport.pauseProducer(this,e),this.safeEmit("pause","local",e),this.paused)}},{key:"remotePause",value:function(e){p.debug("remotePause()"),this._closed||this._remotelyPaused||(this._remotelyPaused=!0,this._track.enabled=!1,this.safeEmit("pause","remote",e))}},{key:"resume",value:function(e){return p.debug("resume()"),this._closed?(p.error("resume() | Producer closed"),!1):!this._locallyPaused||(this._locallyPaused=!1,this._remotelyPaused||(this._track.enabled=!0),this._transport&&this._transport.resumeProducer(this,e),this.safeEmit("resume","local",e),!this.paused)}},{key:"remoteResume",value:function(e){p.debug("remoteResume()"),!this._closed&&this._remotelyPaused&&(this._remotelyPaused=!1,this._locallyPaused||(this._track.enabled=!0),this.safeEmit("resume","remote",e))}},{key:"replaceTrack",value:function(e){var t=this;if(p.debug("replaceTrack() [track:%o]",e),this._closed)return Promise.reject(new s.InvalidStateError("Producer closed"));if(!(e instanceof MediaStreamTrack))return Promise.reject(new TypeError("track is not a MediaStreamTrack"));if("ended"===e.readyState)return Promise.reject(new Error('track.readyState is "ended"'));var r=void 0;try{r=e.clone()}catch(t){r=e}return Promise.resolve().then(function(){if(t._transport)return t._transport.replaceProducerTrack(t,r)}).then(function(){try{t._track.onended=null,t._track.stop()}catch(e){}return t.paused?r.enabled=!1:r.enabled=!0,t._originalTrack=e,t._track=r,t._handleTrack(),t._track})}},{key:"setRtpParameters",value:function(e){this._rtpParameters=e}},{key:"enableStats",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d;p.debug("enableStats() [interval:%s]",e),this._closed?p.error("enableStats() | Producer closed"):this._statsEnabled||(this._statsInterval="number"!=typeof e||e<1e3?d:e,this._statsEnabled=!0,this._transport&&this._transport.enableProducerStats(this,this._statsInterval))}},{key:"disableStats",value:function(){p.debug("disableStats()"),this._closed?p.error("disableStats() | Producer closed"):this._statsEnabled&&(this._statsEnabled=!1,this._transport&&this._transport.disableProducerStats(this))}},{key:"remoteStats",value:function(e){this.safeEmit("stats",e)}},{key:"_handleTrack",value:function(){var e=this;this._track.onended=function(){e._closed||(p.warn('track "ended" event'),e.safeEmit("trackended"))}}},{key:"id",get:function(){return this._id}},{key:"closed",get:function(){return this._closed}},{key:"kind",get:function(){return this._track.kind}},{key:"track",get:function(){return this._track}},{key:"originalTrack",get:function(){return this._originalTrack}},{key:"simulcast",get:function(){return this._simulcast}},{key:"appData",get:function(){return this._appData}},{key:"transport",get:function(){return this._transport}},{key:"rtpParameters",get:function(){return this._rtpParameters}},{key:"locallyPaused",get:function(){return this._locallyPaused}},{key:"remotelyPaused",get:function(){return this._remotelyPaused}},{key:"paused",get:function(){return this._locallyPaused||this._remotelyPaused}}]),t}();r.default=f},{"./EnhancedEventEmitter":4,"./Logger":5,"./errors":10,"./utils":24}],8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=m(e("./Logger")),i=m(e("./EnhancedEventEmitter")),s=e("./errors"),c=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}}(e("./ortc")),u=m(e("./Device")),d=m(e("./Transport")),l=m(e("./Producer")),p=m(e("./Peer")),f=m(e("./Consumer"));function m(e){return e&&e.__esModule?e:{default:e}}var h=new a.default("Room"),v={new:"new",joining:"joining",joined:"joined",closed:"closed"},y=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,h));if(h.debug("constructor() [options:%o]",e),!u.default.isSupported())throw new Error("current browser/device not supported");return e=e||{},r._settings={roomSettings:e.roomSettings,requestTimeout:e.requestTimeout||1e4,transportOptions:e.transportOptions||{},turnServers:e.turnServers||[]},r._state=v.new,r._peerName=null,r._transports=new Map,r._producers=new Map,r._peers=new Map,r._extendedRtpCapabilities=null,r._canSendByKind={audio:!1,video:!1},r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),o(t,[{key:"getTransportById",value:function(e){return this._transports.get(e)}},{key:"getProducerById",value:function(e){return this._producers.get(e)}},{key:"getPeerByName",value:function(e){return this._peers.get(e)}},{key:"join",value:function(e,t){var r=this;if(h.debug('join() [peerName:"%s"]',e),"string"!=typeof e)return Promise.reject(new TypeError("invalid peerName"));if(this._state!==v.new&&this._state!==v.closed)return Promise.reject(new s.InvalidStateError('invalid state "'+this._state+'"'));this._peerName=e,this._state=v.joining;var n=void 0;return Promise.resolve().then(function(){return r._settings.roomSettings?void(n=r._settings.roomSettings):r._sendRequest("queryRoom",{target:"room"}).then(function(e){n=e,h.debug("join() | got Room settings:%o",n)})}).then(function(){return u.default.Handler.getNativeRtpCapabilities()}).then(function(e){h.debug("join() | native RTP capabilities:%o",e),r._extendedRtpCapabilities=c.getExtendedRtpCapabilities(e,n.rtpCapabilities),h.debug("join() | extended RTP capabilities:%o",r._extendedRtpCapabilities);var o=c.getUnsupportedCodecs(n.rtpCapabilities,n.mandatoryCodecPayloadTypes,r._extendedRtpCapabilities);if(o.length>0)throw h.error("%s mandatory room codecs not supported:%o",o.length,o),new s.UnsupportedError("mandatory room codecs not supported",o);r._canSendByKind.audio=c.canSend("audio",r._extendedRtpCapabilities),r._canSendByKind.video=c.canSend("video",r._extendedRtpCapabilities);var a=c.getRtpCapabilities(r._extendedRtpCapabilities);h.debug("join() | effective local RTP capabilities for receiving:%o",a);var i={target:"room",peerName:r._peerName,rtpCapabilities:a,appData:t};return r._sendRequest("join",i).then(function(e){return e.peers})}).then(function(e){var t=!0,n=!1,o=void 0;try{for(var a,i=(e||[])[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var s=a.value;try{r._handlePeerData(s)}catch(e){h.error("join() | error handling Peer:%o",e)}}}catch(e){n=!0,o=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw o}}return r._state=v.joined,h.debug("join() | joined the Room"),r.peers}).catch(function(e){throw r._state=v.new,e})}},{key:"leave",value:function(e){if(h.debug("leave()"),!this.closed){this._sendNotification("leave",{appData:e}),this._state=v.closed,this.safeEmit("close","local",e);var t=!0,r=!1,n=void 0;try{for(var o,a=this._transports.values()[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){o.value.close()}}catch(e){r=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(r)throw n}}var i=!0,s=!1,c=void 0;try{for(var u,d=this._producers.values()[Symbol.iterator]();!(i=(u=d.next()).done);i=!0){u.value.close()}}catch(e){s=!0,c=e}finally{try{!i&&d.return&&d.return()}finally{if(s)throw c}}var l=!0,p=!1,f=void 0;try{for(var m,y=this._peers.values()[Symbol.iterator]();!(l=(m=y.next()).done);l=!0){m.value.close()}}catch(e){p=!0,f=e}finally{try{!l&&y.return&&y.return()}finally{if(p)throw f}}}}},{key:"remoteClose",value:function(e){if(h.debug("remoteClose()"),!this.closed){this._state=v.closed,this.safeEmit("close","remote",e);var t=!0,r=!1,n=void 0;try{for(var o,a=this._transports.values()[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){o.value.remoteClose()}}catch(e){r=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(r)throw n}}var i=!0,s=!1,c=void 0;try{for(var u,d=this._producers.values()[Symbol.iterator]();!(i=(u=d.next()).done);i=!0){u.value.remoteClose()}}catch(e){s=!0,c=e}finally{try{!i&&d.return&&d.return()}finally{if(s)throw c}}var l=!0,p=!1,f=void 0;try{for(var m,y=this._peers.values()[Symbol.iterator]();!(l=(m=y.next()).done);l=!0){m.value.remoteClose()}}catch(e){p=!0,f=e}finally{try{!l&&y.return&&y.return()}finally{if(p)throw f}}}}},{key:"canSend",value:function(e){if(!this.joined)throw new s.InvalidStateError('invalid state "'+this._state+'"');if("audio"!==e&&"video"!==e)throw new TypeError('invalid kind "'+e+'"');return this._canSendByKind[e]}},{key:"createTransport",value:function(e,t){var r=this;if(h.debug("createTransport() [direction:%s]",e),!this.joined)throw new s.InvalidStateError('invalid state "'+this._state+'"');if("send"!==e&&"recv"!==e)throw new TypeError('invalid direction "'+e+'"');var n=new d.default(e,this._extendedRtpCapabilities,this._settings,t);return this._transports.set(n.id,n),n.on("@request",function(e,t,n,o){r._sendRequest(e,t).then(n).catch(o)}),n.on("@notify",function(e,t){r._sendNotification(e,t)}),n.on("@close",function(){r._transports.delete(n.id)}),n}},{key:"createProducer",value:function(e,t,r){var n=this;if(h.debug("createProducer() [track:%o, options:%o]",e,t),!this.joined)throw new s.InvalidStateError('invalid state "'+this._state+'"');if(!(e instanceof MediaStreamTrack))throw new TypeError("track is not a MediaStreamTrack");if(!this._canSendByKind[e.kind])throw new Error("cannot send "+e.kind);if("ended"===e.readyState)throw new Error('track.readyState is "ended"');t=t||{};var o=new l.default(e,t,r);return this._producers.set(o.id,o),o.on("@close",function(){n._producers.delete(o.id)}),o}},{key:"restartIce",value:function(){if(!this.joined)throw new s.InvalidStateError('invalid state "'+this._state+'"');var e=!0,t=!1,r=void 0;try{for(var n,o=this._transports.values()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.restartIce()}}catch(e){t=!0,r=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw r}}}},{key:"receiveNotification",value:function(e){var t=this;if(this.closed)return Promise.reject(new s.InvalidStateError("Room closed"));if("object"!==(void 0===e?"undefined":n(e)))return Promise.reject(new TypeError("wrong notification Object"));if(!0!==e.notification)return Promise.reject(new TypeError("not a notification"));if("string"!=typeof e.method)return Promise.reject(new TypeError("wrong/missing notification method"));var r=e.method;return h.debug("receiveNotification() [method:%s, notification:%o]",r,e),Promise.resolve().then(function(){switch(r){case"closed":var n=e.appData;t.remoteClose(n);break;case"transportClosed":var o=e.id,a=e.appData,i=t._transports.get(o);if(!i)throw new Error('Transport not found [id:"'+o+'"]');i.remoteClose(a);break;case"transportStats":var s=e.id,c=e.stats,u=t._transports.get(s);if(!u)throw new Error("transport not found [id:"+s+"]");u.remoteStats(c);break;case"newPeer":var d=e.name;if(t._peers.has(d))throw new Error('Peer already exists [name:"'+d+'"]');var l=e;t._handlePeerData(l);break;case"peerClosed":var p=e.name,f=e.appData,m=t._peers.get(p);if(!m)throw new Error('no Peer found [name:"'+p+'"]');m.remoteClose(f);break;case"producerPaused":var h=e.id,v=e.appData,y=t._producers.get(h);if(!y)throw new Error("Producer not found [id:"+h+"]");y.remotePause(v);break;case"producerResumed":var _=e.id,g=e.appData,b=t._producers.get(_);if(!b)throw new Error("Producer not found [id:"+_+"]");b.remoteResume(g);break;case"producerClosed":var w=e.id,P=e.appData,k=t._producers.get(w);if(!k)throw new Error("Producer not found [id:"+w+"]");k.remoteClose(P);break;case"producerStats":var S=e.id,C=e.stats,T=t._producers.get(S);if(!T)throw new Error("Producer not found [id:"+S+"]");T.remoteStats(C);break;case"newConsumer":var E=e.peerName,R=t._peers.get(E);if(!R)throw new Error('no Peer found [name:"'+E+'"]');var x=e;t._handleConsumerData(x,R);break;case"consumerClosed":var O=e.id,j=e.peerName,I=e.appData,D=t._peers.get(j);if(!D)throw new Error('no Peer found [name:"'+j+'"]');var F=D.getConsumerById(O);if(!F)throw new Error("Consumer not found [id:"+O+"]");F.remoteClose(I);break;case"consumerPaused":var L=e.id,A=e.peerName,M=e.appData,N=t._peers.get(A);if(!N)throw new Error('no Peer found [name:"'+A+'"]');var B=N.getConsumerById(L);if(!B)throw new Error("Consumer not found [id:"+L+"]");B.remotePause(M);break;case"consumerResumed":var U=e.id,z=e.peerName,G=e.appData,q=t._peers.get(z);if(!q)throw new Error('no Peer found [name:"'+z+'"]');var K=q.getConsumerById(U);if(!K)throw new Error("Consumer not found [id:"+U+"]");K.remoteResume(G);break;case"consumerPreferredProfileSet":var V=e.id,W=e.peerName,Q=e.profile,$=t._peers.get(W);if(!$)throw new Error('no Peer found [name:"'+W+'"]');var J=$.getConsumerById(V);if(!J)throw new Error("Consumer not found [id:"+V+"]");J.remoteSetPreferredProfile(Q);break;case"consumerEffectiveProfileChanged":var H=e.id,X=e.peerName,Z=e.profile,Y=t._peers.get(X);if(!Y)throw new Error('no Peer found [name:"'+X+'"]');var ee=Y.getConsumerById(H);if(!ee)throw new Error("Consumer not found [id:"+H+"]");ee.remoteEffectiveProfileChanged(Z);break;case"consumerStats":var te=e.id,re=e.peerName,ne=e.stats,oe=t._peers.get(re);if(!oe)throw new Error('no Peer found [name:"'+re+'"]');var ae=oe.getConsumerById(te);if(!ae)throw new Error("Consumer not found [id:"+te+"]");ae.remoteStats(ne);break;default:throw new Error('unknown notification method "'+r+'"')}}).catch(function(t){h.error("receiveNotification() failed [notification:%o]: %s",e,t)})}},{key:"_sendRequest",value:function(e,t){var r=this,n=Object.assign({method:e,target:"peer"},t);return this.closed?(h.error("_sendRequest() | Room closed [method:%s, request:%o]",e,n),Promise.reject(new s.InvalidStateError("Room closed"))):(h.debug("_sendRequest() [method:%s, request:%o]",e,n),new Promise(function(t,o){var a=!1,i=setTimeout(function(){h.error("request failed [method:%s]: timeout",e),a=!0,o(new s.TimeoutError("timeout"))},r._settings.requestTimeout);r.safeEmit("request",n,function(n){if(!a){if(a=!0,clearTimeout(i),r.closed)return h.error("request failed [method:%s]: Room closed",e),void o(new Error("Room closed"));h.debug("request succeeded [method:%s, response:%o]",e,n),t(n)}},function(t){if(!a){if(a=!0,clearTimeout(i),r.closed)return h.error("request failed [method:%s]: Room closed",e),void o(new Error("Room closed"));t instanceof Error||(t=new Error(String(t))),h.error("request failed [method:%s]:%o",e,t),o(t)}})}))}},{key:"_sendNotification",value:function(e,t){if(!this.closed){var r=Object.assign({method:e,target:"peer",notification:!0},t);h.debug("_sendNotification() [method:%s, notification:%o]",e,r),this.safeEmit("notify",r)}}},{key:"_handlePeerData",value:function(e){var t=this,r=e.name,n=e.consumers,o=e.appData,a=new p.default(r,o);this._peers.set(a.name,a),a.on("@close",function(){t._peers.delete(a.name)});var i=!0,s=!1,c=void 0;try{for(var u,d=n[Symbol.iterator]();!(i=(u=d.next()).done);i=!0){var l=u.value;try{this._handleConsumerData(l,a)}catch(e){h.error("error handling existing Consumer in Peer:%o",e)}}}catch(e){s=!0,c=e}finally{try{!i&&d.return&&d.return()}finally{if(s)throw c}}this.joined&&this.safeEmit("newpeer",a)}},{key:"_handleConsumerData",value:function(e,t){var r=e.id,n=e.kind,o=e.rtpParameters,a=e.paused,i=e.appData,s=new f.default(r,n,o,t,i);c.canReceive(s.rtpParameters,this._extendedRtpCapabilities)&&s.setSupported(!0),a&&s.remotePause(),t.addConsumer(s)}},{key:"joined",get:function(){return this._state===v.joined}},{key:"closed",get:function(){return this._state===v.closed}},{key:"peerName",get:function(){return this._peerName}},{key:"transports",get:function(){return Array.from(this._transports.values())}},{key:"producers",get:function(){return Array.from(this._producers.values())}},{key:"peers",get:function(){return Array.from(this._peers.values())}}]),t}();r.default=y},{"./Consumer":2,"./Device":3,"./EnhancedEventEmitter":4,"./Logger":5,"./Peer":6,"./Producer":7,"./Transport":9,"./errors":10,"./ortc":23}],9:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=d(e("./Logger")),a=d(e("./EnhancedEventEmitter")),i=e("./errors"),s=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}}(e("./utils")),c=d(e("./Device")),u=d(e("./CommandQueue"));function d(e){return e&&e.__esModule?e:{default:e}}var l=new o.default("Transport"),p=function(e){function t(e,r,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,l));return l.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",e,r),a._id=s.randomNumber(),a._closed=!1,a._direction=e,a._settings=n,a._appData=o,a._statsEnabled=!1,a._commandQueue=new u.default,a._handler=new c.default.Handler(e,r,n),a._connectionState="new",a._commandQueue.on("exec",a._execCommand.bind(a)),a._handleHandler(),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),n(t,[{key:"close",value:function(e){l.debug("close()"),this._closed||(this._closed=!0,this._statsEnabled&&(this._statsEnabled=!1,this.disableStats()),this.safeEmit("@notify","closeTransport",{id:this._id,appData:e}),this.emit("@close"),this.safeEmit("close","local",e),this._destroy())}},{key:"remoteClose",value:function(e){l.debug("remoteClose()"),this._closed||(this._closed=!0,this.emit("@close"),this.safeEmit("close","remote",e),this._destroy())}},{key:"_destroy",value:function(){this._commandQueue.close(),this._handler.close()}},{key:"restartIce",value:function(){var e=this;l.debug("restartIce()"),this._closed||"new"!==this._connectionState&&Promise.resolve().then(function(){var t={id:e._id};return e.safeEmitAsPromise("@request","restartTransport",t)}).then(function(t){var r=t.iceParameters;return e._commandQueue.push("restartIce",{remoteIceParameters:r})}).catch(function(e){l.error("restartIce() | failed: %o",e)})}},{key:"enableStats",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;l.debug("enableStats() [interval:%s]",e),("number"!=typeof e||e<1e3)&&(e=1e3),this._statsEnabled=!0;var t={id:this._id,interval:e};this.safeEmit("@notify","enableTransportStats",t)}},{key:"disableStats",value:function(){l.debug("disableStats()"),this._statsEnabled=!1;var e={id:this._id};this.safeEmit("@notify","disableTransportStats",e)}},{key:"_handleHandler",value:function(){var e=this,t=this._handler;t.on("@connectionstatechange",function(t){e._connectionState!==t&&(l.debug("Transport connection state changed to %s",t),e._connectionState=t,e._closed||e.safeEmit("connectionstatechange",t))}),t.on("@needcreatetransport",function(t,r,n){var o={id:e._id,direction:e._direction,options:e._settings.transportOptions,appData:e._appData};t&&(o.dtlsParameters=t.dtlsParameters),e.safeEmit("@request","createTransport",o,r,n)}),t.on("@needupdatetransport",function(t){var r={id:e._id,dtlsParameters:t.dtlsParameters};e.safeEmit("@notify","updateTransport",r)}),t.on("@needupdateproducer",function(t,r){var n={id:t.id,rtpParameters:r};t.setRtpParameters(r),e.safeEmit("@notify","updateProducer",n)})}},{key:"addProducer",value:function(e){return l.debug("addProducer() [producer:%o]",e),this._closed?Promise.reject(new i.InvalidStateError("Transport closed")):"send"!==this._direction?Promise.reject(new Error("not a sending Transport")):this._commandQueue.push("addProducer",{producer:e})}},{key:"removeProducer",value:function(e,t,r){l.debug("removeProducer() [producer:%o]",e),this._closed||this._commandQueue.push("removeProducer",{producer:e}).catch(function(){}),"local"===t&&this.safeEmit("@notify","closeProducer",{id:e.id,appData:r})}},{key:"pauseProducer",value:function(e,t){l.debug("pauseProducer() [producer:%o]",e);var r={id:e.id,appData:t};this.safeEmit("@notify","pauseProducer",r)}},{key:"resumeProducer",value:function(e,t){l.debug("resumeProducer() [producer:%o]",e);var r={id:e.id,appData:t};this.safeEmit("@notify","resumeProducer",r)}},{key:"replaceProducerTrack",value:function(e,t){return l.debug("replaceProducerTrack() [producer:%o]",e),this._commandQueue.push("replaceProducerTrack",{producer:e,track:t})}},{key:"enableProducerStats",value:function(e,t){l.debug("enableProducerStats() [producer:%o]",e);var r={id:e.id,interval:t};this.safeEmit("@notify","enableProducerStats",r)}},{key:"disableProducerStats",value:function(e){l.debug("disableProducerStats() [producer:%o]",e);var t={id:e.id};this.safeEmit("@notify","disableProducerStats",t)}},{key:"addConsumer",value:function(e){return l.debug("addConsumer() [consumer:%o]",e),this._closed?Promise.reject(new i.InvalidStateError("Transport closed")):"recv"!==this._direction?Promise.reject(new Error("not a receiving Transport")):this._commandQueue.push("addConsumer",{consumer:e})}},{key:"removeConsumer",value:function(e){l.debug("removeConsumer() [consumer:%o]",e),this._commandQueue.push("removeConsumer",{consumer:e}).catch(function(){})}},{key:"pauseConsumer",value:function(e,t){l.debug("pauseConsumer() [consumer:%o]",e);var r={id:e.id,appData:t};this.safeEmit("@notify","pauseConsumer",r)}},{key:"resumeConsumer",value:function(e,t){l.debug("resumeConsumer() [consumer:%o]",e);var r={id:e.id,appData:t};this.safeEmit("@notify","resumeConsumer",r)}},{key:"setConsumerPreferredProfile",value:function(e,t){l.debug("setConsumerPreferredProfile() [consumer:%o]",e);var r={id:e.id,profile:t};this.safeEmit("@notify","setConsumerPreferredProfile",r)}},{key:"enableConsumerStats",value:function(e,t){l.debug("enableConsumerStats() [consumer:%o]",e);var r={id:e.id,interval:t};this.safeEmit("@notify","enableConsumerStats",r)}},{key:"disableConsumerStats",value:function(e){l.debug("disableConsumerStats() [consumer:%o]",e);var t={id:e.id};this.safeEmit("@notify","disableConsumerStats",t)}},{key:"remoteStats",value:function(e){this.safeEmit("stats",e)}},{key:"_execCommand",value:function(e,t){var r=void 0;try{switch(e.method){case"addProducer":var n=e.producer;r=this._execAddProducer(n);break;case"removeProducer":var o=e.producer;r=this._execRemoveProducer(o);break;case"replaceProducerTrack":var a=e.producer,i=e.track;r=this._execReplaceProducerTrack(a,i);break;case"addConsumer":var s=e.consumer;r=this._execAddConsumer(s);break;case"removeConsumer":var c=e.consumer;r=this._execRemoveConsumer(c);break;case"restartIce":var u=e.remoteIceParameters;r=this._execRestartIce(u);break;default:r=Promise.reject(new Error('unknown command method "'+e.method+'"'))}}catch(e){r=Promise.reject(e)}t.promise=r}},{key:"_execAddProducer",value:function(e){var t=this;l.debug("_execAddProducer()");var r=void 0;return Promise.resolve().then(function(){return t._handler.addProducer(e)}).then(function(n){r=n;var o={id:e.id,kind:e.kind,transportId:t._id,rtpParameters:n,paused:e.locallyPaused,appData:e.appData};return t.safeEmitAsPromise("@request","createProducer",o)}).then(function(){e.setRtpParameters(r)})}},{key:"_execRemoveProducer",value:function(e){return l.debug("_execRemoveProducer()"),this._handler.removeProducer(e)}},{key:"_execReplaceProducerTrack",value:function(e,t){return l.debug("_execReplaceProducerTrack()"),this._handler.replaceProducerTrack(e,t)}},{key:"_execAddConsumer",value:function(e){var t=this;l.debug("_execAddConsumer()");var r=void 0;return Promise.resolve().then(function(){return t._handler.addConsumer(e)}).then(function(n){r=n;var o={id:e.id,transportId:t.id,paused:e.locallyPaused,preferredProfile:e.preferredProfile};return t.safeEmitAsPromise("@request","enableConsumer",o)}).then(function(t){var n=t.paused,o=t.preferredProfile,a=t.effectiveProfile;return n&&e.remotePause(),o&&e.remoteSetPreferredProfile(o),a&&e.remoteEffectiveProfileChanged(a),r})}},{key:"_execRemoveConsumer",value:function(e){return l.debug("_execRemoveConsumer()"),this._handler.removeConsumer(e)}},{key:"_execRestartIce",value:function(e){return l.debug("_execRestartIce()"),this._handler.restartIce(e)}},{key:"id",get:function(){return this._id}},{key:"closed",get:function(){return this._closed}},{key:"direction",get:function(){return this._direction}},{key:"appData",get:function(){return this._appData}},{key:"connectionState",get:function(){return this._connectionState}}]),t}();r.default=p},{"./CommandQueue":1,"./Device":3,"./EnhancedEventEmitter":4,"./Logger":5,"./errors":10,"./utils":24}],10:[function(e,t,r){(function(e){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i,s,c,u,d=(i=Object,s=i.getPrototypeOf||function(e){return e.__proto__},c=i.setPrototypeOf||function(e,t){return e.__proto__=t,e},u="object"===("undefined"==typeof Reflect?"undefined":t(Reflect))?Reflect.construct:function(e,t,r){var n,o=[null];return o.push.apply(o,t),n=e.bind.apply(e,o),c(new n,r.prototype)},function(e){var t=s(e);return c(e,c(function(){return u(t,arguments,s(this).constructor)},t))}),l=r.InvalidStateError=d(function(e){function t(e){n(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(r,t):r.stack=new Error(e).stack,r}return a(t,Error),t}());e.InvalidStateError=l;r.TimeoutError=d(function(e){function t(e){n(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.name="TimeoutError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(r,l):r.stack=new Error(e).stack,r}return a(t,Error),t}()),r.UnsupportedError=d(function(e){function t(e,r){n(this,t);var a=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(a,l):a.stack=new Error(e).stack,a.data=r,a}return a(t,Error),t}())}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=f(e("sdp-transform")),a=f(e("../Logger")),i=f(e("../EnhancedEventEmitter")),s=p(e("../utils")),c=p(e("../ortc")),u=p(e("./sdp/commonUtils")),d=p(e("./sdp/planBUtils")),l=f(e("./sdp/RemotePlanBSdp"));function p(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function f(e){return e&&e.__esModule?e:{default:e}}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var y=new a.default("Chrome55"),_=function(e){function t(e,r,n){m(this,t);var o=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,y));return o._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),o._rtpParametersByKind=r,o._remoteSdp=new l.default(e,r),o._pc.addEventListener("iceconnectionstatechange",function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}}),o}return v(t,i.default),n(t,[{key:"close",value:function(){y.debug("close()");try{this._pc.close()}catch(e){}}}]),t}(),g=function(e){function t(e,r){m(this,t);var n=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"send",e,r));return n._transportReady=!1,n._stream=new MediaStream,n}return v(t,_),n(t,[{key:"addProducer",value:function(e){var t=this,r=e.track;if(y.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),this._stream.getTrackById(r.id))return Promise.reject(new Error("track already added"));var n=void 0;return Promise.resolve().then(function(){return t._stream.addTrack(r),t._pc.addStream(t._stream),t._pc.createOffer()}).then(function(n){if(e.simulcast){y.debug("addProducer() | enabling simulcast");var a=o.default.parse(n.sdp);d.addSimulcastForTrack(a,r),n={type:"offer",sdp:o.default.write(a)}}return y.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",n),t._pc.setLocalDescription(n)}).then(function(){if(!t._transportReady)return t._setupTransport()}).then(function(){n=o.default.parse(t._pc.localDescription.sdp);var e={type:"answer",sdp:t._remoteSdp.createAnswerSdp(n)};return y.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){var o=s.clone(t._rtpParametersByKind[e.kind]);return d.fillRtpParametersForTrack(o,n,r),o}).catch(function(e){throw t._stream.removeTrack(r),t._pc.addStream(t._stream),e})}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return y.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then(function(){return t._stream.removeTrack(r),t._pc.addStream(t._stream),t._pc.createOffer()}).then(function(e){return y.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).catch(function(e){if(0!==t._stream.getTracks().length)throw e;y.warn("removeProducer() | ignoring expected error due no sending tracks: %s",e.toString())}).then(function(){if("stable"!==t._pc.signalingState){var e=o.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return y.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}})}},{key:"replaceProducerTrack",value:function(e,t){var r=this;y.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track,a=void 0;return Promise.resolve().then(function(){return r._stream.removeTrack(n),r._stream.addTrack(t),r._pc.addStream(r._stream),r._pc.createOffer()}).then(function(n){if(e.simulcast){y.debug("addProducer() | enabling simulcast");var a=o.default.parse(n.sdp);d.addSimulcastForTrack(a,t),n={type:"offer",sdp:o.default.write(a)}}return y.debug("replaceProducerTrack() | calling pc.setLocalDescription() [offer:%o]",n),r._pc.setLocalDescription(n)}).then(function(){a=o.default.parse(r._pc.localDescription.sdp);var e={type:"answer",sdp:r._remoteSdp.createAnswerSdp(a)};return y.debug("replaceProducerTrack() | calling pc.setRemoteDescription() [answer:%o]",e),r._pc.setRemoteDescription(e)}).then(function(){var n=s.clone(r._rtpParametersByKind[e.kind]);d.fillRtpParametersForTrack(n,a,t),r.safeEmit("@needupdateproducer",e,n)}).catch(function(e){throw r._stream.removeTrack(t),r._stream.addTrack(n),r._pc.addStream(r._stream),e})}},{key:"restartIce",value:function(e){var t=this;return y.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return t._pc.createOffer({iceRestart:!0})}).then(function(e){return y.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){var e=o.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return y.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)})}},{key:"_setupTransport",value:function(){var e=this;return y.debug("_setupTransport()"),Promise.resolve().then(function(){var t={},r=e._pc.localDescription.sdp,n=o.default.parse(r),a=u.extractDtlsParameters(n);return a.role="server",t.dtlsParameters=a,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0})}}]),t}(),b=function(e){function t(e,r){m(this,t);var n=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"recv",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._kinds=new Set,n._consumerInfos=new Map,n}return v(t,_),n(t,[{key:"addConsumer",value:function(e){var t=this;if(y.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={kind:e.kind,streamId:"recv-stream-"+e.id,trackId:"consumer-"+e.kind+"-"+e.id,ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),this._kinds.add(e.kind),Promise.resolve().then(function(){if(!t._transportCreated)return t._setupTransport()}).then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return y.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportUpdated)return t._updateTransport()}).then(function(){var e=t._pc.getRemoteStreams().find(function(e){return e.id===o.streamId}).getTrackById(o.trackId);if(!e)throw new Error("remote track not found");return e})}},{key:"removeConsumer",value:function(e){var t=this;return y.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return y.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return y.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return y.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var e=this;return y.debug("_setupTransport()"),Promise.resolve().then(function(){return e.safeEmitAsPromise("@needcreatetransport",null)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0})}},{key:"_updateTransport",value:function(){y.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=o.default.parse(e),r={dtlsParameters:u.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),t}(),w=function(){function e(t,r,n){m(this,e),y.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r);var o=void 0;switch(t){case"send":return o={audio:c.getSendingRtpParameters("audio",r),video:c.getSendingRtpParameters("video",r)},new g(o,n);case"recv":return o={audio:c.getReceivingFullRtpParameters("audio",r),video:c.getReceivingFullRtpParameters("video",r)},new b(o,n)}}return n(e,null,[{key:"getNativeRtpCapabilities",value:function(){y.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});return e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(function(t){try{e.close()}catch(e){}var r=o.default.parse(t.sdp);return u.extractRtpCapabilities(r)}).catch(function(t){try{e.close()}catch(e){}throw t})}},{key:"tag",get:function(){return"Chrome55"}}]),e}();r.default=w},{"../EnhancedEventEmitter":4,"../Logger":5,"../ortc":23,"../utils":24,"./sdp/RemotePlanBSdp":17,"./sdp/commonUtils":19,"./sdp/planBUtils":20,"sdp-transform":33}],12:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=d(e("../Logger")),a=d(e("../EnhancedEventEmitter")),i=u(e("../utils")),s=u(e("../ortc")),c=u(e("./ortc/edgeUtils"));function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function d(e){return e&&e.__esModule?e:{default:e}}var l="CNAME-EDGE-"+i.randomNumber(),p=new o.default("Edge11"),f=function(e){function t(e,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,p));return p.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",e,r),o._rtpParametersByKind={audio:s.getSendingRtpParameters("audio",r),video:s.getSendingRtpParameters("video",r)},o._transportReady=!1,o._iceGatherer=null,o._iceTransport=null,o._dtlsTransport=null,o._rtpSenders=new Map,o._rtpReceivers=new Map,o._transportRemoteParameters=null,o._setIceGatherer(n),o._setIceTransport(),o._setDtlsTransport(),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),n(t,null,[{key:"getNativeRtpCapabilities",value:function(){return p.debug("getNativeRtpCapabilities()"),c.getCapabilities()}},{key:"tag",get:function(){return"Edge11"}}]),n(t,[{key:"close",value:function(){p.debug("close()");try{this._iceGatherer.close()}catch(e){}try{this._iceTransport.stop()}catch(e){}try{this._dtlsTransport.stop()}catch(e){}var e=!0,t=!1,r=void 0;try{for(var n,o=this._rtpSenders.values()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var a=n.value;try{a.stop()}catch(e){}}}catch(e){t=!0,r=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw r}}var i=!0,s=!1,c=void 0;try{for(var u,d=this._rtpReceivers.values()[Symbol.iterator]();!(i=(u=d.next()).done);i=!0){var l=u.value;try{l.stop()}catch(e){}}}catch(e){s=!0,c=e}finally{try{!i&&d.return&&d.return()}finally{if(s)throw c}}}},{key:"addProducer",value:function(e){var t=this,r=e.track;return p.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),this._rtpSenders.has(e.id)?Promise.reject(new Error("Producer already added")):Promise.resolve().then(function(){if(!t._transportReady)return t._setupTransport()}).then(function(){p.debug("addProducer() | calling new RTCRtpSender()");var n=new RTCRtpSender(r,t._dtlsTransport),o=i.clone(t._rtpParametersByKind[e.kind]),a={ssrc:i.randomNumber()};o.codecs.some(function(e){return"rtx"===e.name})&&(a.rtx={ssrc:i.randomNumber()}),o.encodings.push(a),o.rtcp={cname:l,reducedSize:!0,mux:!0};var s=c.mangleRtpParameters(o);return p.debug("addProducer() | calling rtpSender.send() [params:%o]",s),n.send(s),t._rtpSenders.set(e.id,n),o})}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return p.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then(function(){var r=t._rtpSenders.get(e.id);if(!r)throw new Error("RTCRtpSender not found");t._rtpSenders.delete(e.id);try{p.debug("removeProducer() | calling rtpSender.stop()"),r.stop()}catch(e){p.warn("rtpSender.stop() failed:%o",e)}})}},{key:"replaceProducerTrack",value:function(e,t){var r=this;return p.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id),Promise.resolve().then(function(){var n=r._rtpSenders.get(e.id);if(!n)throw new Error("RTCRtpSender not found");n.setTrack(t)})}},{key:"addConsumer",value:function(e){var t=this;return p.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._rtpReceivers.has(e.id)?Promise.reject(new Error("Consumer already added")):Promise.resolve().then(function(){if(!t._transportReady)return t._setupTransport()}).then(function(){p.debug("addProducer() | calling new RTCRtpReceiver()");var r=new RTCRtpReceiver(t._dtlsTransport,e.kind);r.addEventListener("error",function(e){p.error('iceGatherer "error" event [event:%o]',e)});var n=c.mangleRtpParameters(e.rtpParameters);return p.debug("addProducer() | calling rtpReceiver.receive() [params:%o]",n),r.receive(n),t._rtpReceivers.set(e.id,r),r.track})}},{key:"removeConsumer",value:function(e){var t=this;return p.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),Promise.resolve().then(function(){var r=t._rtpReceivers.get(e.id);if(!r)throw new Error("RTCRtpReceiver not found");t._rtpReceivers.delete(e.id);try{p.debug("removeConsumer() | calling rtpReceiver.stop()"),r.stop()}catch(e){p.warn("rtpReceiver.stop() failed:%o",e)}})}},{key:"restartIce",value:function(e){var t=this;p.debug("restartIce()"),Promise.resolve().then(function(){t._transportRemoteParameters.iceParameters=e;var r=t._transportRemoteParameters.iceCandidates;p.debug("restartIce() | calling iceTransport.start()"),t._iceTransport.start(t._iceGatherer,e,"controlling");var n=!0,o=!1,a=void 0;try{for(var i,s=r[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var c=i.value;t._iceTransport.addRemoteCandidate(c)}}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}t._iceTransport.addRemoteCandidate({})})}},{key:"_setIceGatherer",value:function(e){var t=new RTCIceGatherer({iceServers:e.turnServers||[],gatherPolicy:"all"});t.addEventListener("error",function(e){p.error('iceGatherer "error" event [event:%o]',e)});try{t.gather()}catch(e){p.debug("iceGatherer.gather() failed: %s",e.toString())}this._iceGatherer=t}},{key:"_setIceTransport",value:function(){var e=this,t=new RTCIceTransport(this._iceGatherer);t.addEventListener("statechange",function(){switch(t.state){case"checking":e.emit("@connectionstatechange","connecting");break;case"connected":case"completed":e.emit("@connectionstatechange","connected");break;case"failed":e.emit("@connectionstatechange","failed");break;case"disconnected":e.emit("@connectionstatechange","disconnected");break;case"closed":e.emit("@connectionstatechange","closed")}}),t.addEventListener("icestatechange",function(){switch(t.state){case"checking":e.emit("@connectionstatechange","connecting");break;case"connected":case"completed":e.emit("@connectionstatechange","connected");break;case"failed":e.emit("@connectionstatechange","failed");break;case"disconnected":e.emit("@connectionstatechange","disconnected");break;case"closed":e.emit("@connectionstatechange","closed")}}),t.addEventListener("candidatepairchange",function(e){p.debug('iceTransport "candidatepairchange" event [pair:%o]',e.pair)}),this._iceTransport=t}},{key:"_setDtlsTransport",value:function(){var e=new RTCDtlsTransport(this._iceTransport);e.addEventListener("statechange",function(){p.debug('dtlsTransport "statechange" event [state:%s]',e.state)}),e.addEventListener("dtlsstatechange",function(){p.debug('dtlsTransport "dtlsstatechange" event [state:%s]',e.state)}),e.addEventListener("error",function(e){p.error('dtlsTransport "error" event [event:%o]',e)}),this._dtlsTransport=e}},{key:"_setupTransport",value:function(){var e=this;return p.debug("_setupTransport()"),Promise.resolve().then(function(){var t={},r=e._dtlsTransport.getLocalParameters();return r.role="server",t.dtlsParameters=r,e.safeEmitAsPromise("@needcreatetransport",t)}).then(function(t){e._transportRemoteParameters=t;var r=t.iceParameters,n=t.iceCandidates,o=t.dtlsParameters;e._iceTransport.start(e._iceGatherer,r,"controlling");var a=!0,i=!1,s=void 0;try{for(var c,u=n[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var d=c.value;e._iceTransport.addRemoteCandidate(d)}}catch(e){i=!0,s=e}finally{try{!a&&u.return&&u.return()}finally{if(i)throw s}}e._iceTransport.addRemoteCandidate({}),o.fingerprints=o.fingerprints.filter(function(e){return"sha-256"===e.algorithm||"sha-384"===e.algorithm||"sha-512"===e.algorithm}),e._dtlsTransport.start(o),e._transportReady=!0})}}]),t}();r.default=f},{"../EnhancedEventEmitter":4,"../Logger":5,"../ortc":23,"../utils":24,"./ortc/edgeUtils":16}],13:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=f(e("sdp-transform")),a=f(e("../Logger")),i=f(e("../EnhancedEventEmitter")),s=p(e("../utils")),c=p(e("../ortc")),u=p(e("./sdp/commonUtils")),d=p(e("./sdp/unifiedPlanUtils")),l=f(e("./sdp/RemoteUnifiedPlanSdp"));function p(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function f(e){return e&&e.__esModule?e:{default:e}}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var y=new a.default("Firefox50"),_=function(e){function t(e,r,n){m(this,t);var o=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,y));return o._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),o._rtpParametersByKind=r,o._remoteSdp=new l.default(e,r),o._pc.addEventListener("iceconnectionstatechange",function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}}),o}return v(t,i.default),n(t,[{key:"close",value:function(){y.debug("close()");try{this._pc.close()}catch(e){}}}]),t}(),g=function(e){function t(e,r){m(this,t);var n=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"send",e,r));return n._transportReady=!1,n._stream=new MediaStream,n._nextRid=1,n}return v(t,_),n(t,[{key:"addProducer",value:function(e){var t=this,r=e.track;if(y.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),this._stream.getTrackById(r.id))return Promise.reject(new Error("track already added"));var n=void 0,a=void 0;return Promise.resolve().then(function(){t._stream.addTrack(r),n=t._pc.addTrack(r,t._stream)}).then(function(){if(e.simulcast){y.debug("addProducer() | enabling simulcast");var r=[];return e.simulcast.high&&r.push({rid:"high"+t._nextRid,active:!0,priority:"high",maxBitrate:e.simulcast.high}),e.simulcast.medium&&r.push({rid:"medium"+t._nextRid,active:!0,priority:"medium",maxBitrate:e.simulcast.medium}),e.simulcast.low&&r.push({rid:"low"+t._nextRid,active:!0,priority:"low",maxBitrate:e.simulcast.low}),t._nextRid++,n.setParameters({encodings:r})}}).then(function(){return t._pc.createOffer()}).then(function(e){return y.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportReady)return t._setupTransport()}).then(function(){a=o.default.parse(t._pc.localDescription.sdp);var e={type:"answer",sdp:t._remoteSdp.createAnswerSdp(a)};return y.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){var n=s.clone(t._rtpParametersByKind[e.kind]);return d.fillRtpParametersForTrack(n,a,r),n}).catch(function(e){try{t._pc.removeTrack(n)}catch(e){}throw t._stream.removeTrack(r),e})}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return y.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then(function(){var e=t._pc.getSenders().find(function(e){return e.track===r});if(!e)throw new Error("RTCRtpSender found");return t._pc.removeTrack(e),t._stream.removeTrack(r),Promise.resolve().then(function(){return t._pc.createOffer()}).then(function(e){return y.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)})}).then(function(){var e=o.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return y.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)})}},{key:"replaceProducerTrack",value:function(e,t){var r=this;y.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return Promise.resolve().then(function(){var e=r._pc.getSenders().find(function(e){return e.track===n});if(!e)throw new Error("local track not found");return e.replaceTrack(t)}).then(function(){r._stream.removeTrack(n),r._stream.addTrack(t)})}},{key:"restartIce",value:function(e){var t=this;return y.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return t._pc.createOffer({iceRestart:!0})}).then(function(e){return y.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){var e=o.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return y.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)})}},{key:"_setupTransport",value:function(){var e=this;return y.debug("_setupTransport()"),Promise.resolve().then(function(){var t={},r=e._pc.localDescription.sdp,n=o.default.parse(r),a=u.extractDtlsParameters(n);return a.role="server",t.dtlsParameters=a,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0})}}]),t}(),b=function(e){function t(e,r){m(this,t);var n=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"recv",e,r));n._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new Map;return n._consumerInfos.set(555,{mid:"fake-dc",kind:"application",closed:!1,cname:null}),n}return v(t,_),n(t,[{key:"addConsumer",value:function(e){var t=this;if(y.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={mid:""+e.kind[0]+e.id,kind:e.kind,closed:e.closed,streamId:"recv-stream-"+e.id,trackId:"consumer-"+e.kind+"-"+e.id,ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),Promise.resolve().then(function(){if(!t._transportCreated)return t._setupTransport()}).then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return y.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportUpdated)return t._updateTransport()}).then(function(){var e=t._pc.getReceivers().find(function(e){var t=e.track;return!!t&&t.id===o.trackId});if(!e)throw new Error("remote track not found");return e.track})}},{key:"removeConsumer",value:function(e){var t=this;y.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return y.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return y.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return y.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var e=this;return y.debug("_setupTransport()"),Promise.resolve().then(function(){return e.safeEmitAsPromise("@needcreatetransport",null)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0})}},{key:"_updateTransport",value:function(){y.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=o.default.parse(e),r={dtlsParameters:u.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),t}(),w=function(){function e(t,r,n){m(this,e),y.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r);var o=void 0;switch(t){case"send":return o={audio:c.getSendingRtpParameters("audio",r),video:c.getSendingRtpParameters("video",r)},new g(o,n);case"recv":return o={audio:c.getReceivingFullRtpParameters("audio",r),video:c.getReceivingFullRtpParameters("video",r)},new b(o,n)}}return n(e,null,[{key:"getNativeRtpCapabilities",value:function(){y.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),t=document.createElement("canvas");t.getContext("2d");var r=t.captureStream(),n=r.getVideoTracks()[0];return e.addTrack(n,r).setParameters({encodings:[{rid:"RID1",maxBitrate:4e4},{rid:"RID2",maxBitrate:1e4}]}),e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(function(r){try{t.remove()}catch(e){}try{e.close()}catch(e){}var n=o.default.parse(r.sdp);return u.extractRtpCapabilities(n)}).catch(function(r){try{t.remove()}catch(e){}try{e.close()}catch(e){}throw r})}},{key:"tag",get:function(){return"Firefox50"}}]),e}();r.default=w},{"../EnhancedEventEmitter":4,"../Logger":5,"../ortc":23,"../utils":24,"./sdp/RemoteUnifiedPlanSdp":18,"./sdp/commonUtils":19,"./sdp/unifiedPlanUtils":21,"sdp-transform":33}],14:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=f(e("sdp-transform")),a=f(e("../Logger")),i=f(e("../EnhancedEventEmitter")),s=p(e("../utils")),c=p(e("../ortc")),u=p(e("./sdp/commonUtils")),d=p(e("./sdp/planBUtils")),l=f(e("./sdp/RemotePlanBSdp"));function p(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function f(e){return e&&e.__esModule?e:{default:e}}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var y=new a.default("ReactNative"),_=function(e){function t(e,r,n){m(this,t);var o=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,y));return o._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),o._rtpParametersByKind=r,o._remoteSdp=new l.default(e,r),o._pc.addEventListener("iceconnectionstatechange",function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}}),o}return v(t,i.default),n(t,[{key:"close",value:function(){y.debug("close()");try{this._pc.close()}catch(e){}}}]),t}(),g=function(e){function t(e,r){m(this,t);var n=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"send",e,r));return n._transportReady=!1,n._tracks=new Set,n}return v(t,_),n(t,[{key:"addProducer",value:function(e){var t=this,r=e.track;if(y.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),this._tracks.has(r))return Promise.reject(new Error("track already added"));if(!r.streamReactTag)return Promise.reject(new Error("no track.streamReactTag property"));var n=void 0,a=void 0;return Promise.resolve().then(function(){return t._tracks.add(r),(n=new MediaStream(r.streamReactTag)).addTrack(r),t._pc.addStream(n),t._pc.createOffer()}).then(function(n){if(e.simulcast){y.debug("addProducer() | enabling simulcast");var a=o.default.parse(n.sdp);d.addSimulcastForTrack(a,r),n={type:"offer",sdp:o.default.write(a)}}y.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",n);var i=new RTCSessionDescription(n);return t._pc.setLocalDescription(i)}).then(function(){if(!t._transportReady)return t._setupTransport()}).then(function(){a=o.default.parse(t._pc.localDescription.sdp);var e={type:"answer",sdp:t._remoteSdp.createAnswerSdp(a)};y.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e);var r=new RTCSessionDescription(e);return t._pc.setRemoteDescription(r)}).then(function(){var n=s.clone(t._rtpParametersByKind[e.kind]);return d.fillRtpParametersForTrack(n,a,r),n}).catch(function(e){throw t._tracks.delete(r),n.removeTrack(r),t._pc.addStream(n),e})}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return y.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),r.streamReactTag?Promise.resolve().then(function(){t._tracks.delete(r);var e=new MediaStream(r.streamReactTag);return e.addTrack(r),t._pc.addStream(e),t._pc.createOffer()}).then(function(e){return y.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).catch(function(e){if(0!==t._tracks.size)throw e;y.warn("removeProducer() | ignoring expected error due no sending tracks: %s",e.toString())}).then(function(){if("stable"!==t._pc.signalingState){var e=o.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};y.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",r);var n=new RTCSessionDescription(r);return t._pc.setRemoteDescription(n)}}):Promise.reject(new Error("no track.streamReactTag property"))}},{key:"replaceProducerTrack",value:function(e,t){var r=this;if(y.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id),!t.streamReactTag)return Promise.reject(new Error("no track.streamReactTag property"));var n=e.track,a=void 0,i=void 0;return Promise.resolve().then(function(){return r._tracks.add(t),r._tracks.delete(n),(a=new MediaStream(t.streamReactTag)).addTrack(t),a.removeTrack(n),r._pc.addStream(a),r._pc.createOffer()}).then(function(n){if(e.simulcast){y.debug("addProducer() | enabling simulcast");var a=o.default.parse(n.sdp);d.addSimulcastForTrack(a,t),n={type:"offer",sdp:o.default.write(a)}}y.debug("replaceProducerTrack() | calling pc.setLocalDescription() [offer:%o]",n);var i=new RTCSessionDescription(n);return r._pc.setLocalDescription(i)}).then(function(){i=o.default.parse(r._pc.localDescription.sdp);var e={type:"answer",sdp:r._remoteSdp.createAnswerSdp(i)};y.debug("replaceProducerTrack() | calling pc.setRemoteDescription() [answer:%o]",e);var t=new RTCSessionDescription(e);return r._pc.setRemoteDescription(t)}).then(function(){var n=s.clone(r._rtpParametersByKind[e.kind]);d.fillRtpParametersForTrack(n,i,t),r.safeEmit("@needupdateproducer",e,n)}).catch(function(e){throw r._tracks.delete(t),a.removeTrack(t),r._pc.addStream(a),e})}},{key:"restartIce",value:function(e){var t=this;return y.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return t._pc.createOffer({iceRestart:!0})}).then(function(e){return y.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){var e=o.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};y.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r);var n=new RTCSessionDescription(r);return t._pc.setRemoteDescription(n)})}},{key:"_setupTransport",value:function(){var e=this;return y.debug("_setupTransport()"),Promise.resolve().then(function(){var t={},r=e._pc.localDescription.sdp,n=o.default.parse(r),a=u.extractDtlsParameters(n);return a.role="server",t.dtlsParameters=a,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0})}}]),t}(),b=function(e){function t(e,r){m(this,t);var n=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"recv",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._kinds=new Set,n._consumerInfos=new Map,n}return v(t,_),n(t,[{key:"addConsumer",value:function(e){var t=this;if(y.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={kind:e.kind,streamId:"recv-stream-"+e.id,trackId:"consumer-"+e.kind+"-"+e.id,ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),this._kinds.add(e.kind),Promise.resolve().then(function(){if(!t._transportCreated)return t._setupTransport()}).then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};y.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e);var r=new RTCSessionDescription(e);return t._pc.setRemoteDescription(r)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportUpdated)return t._updateTransport()}).then(function(){var e=t._pc.getRemoteStreams().find(function(e){return e.id===o.streamId}),r=e.getTrackById(o.trackId);if(r.streamReactTag=e.reactTag,!r)throw new Error("remote track not found");return r})}},{key:"removeConsumer",value:function(e){var t=this;return y.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};y.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e);var r=new RTCSessionDescription(e);return t._pc.setRemoteDescription(r)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return y.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};y.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e);var r=new RTCSessionDescription(e);return t._pc.setRemoteDescription(r)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var e=this;return y.debug("_setupTransport()"),Promise.resolve().then(function(){return e.safeEmitAsPromise("@needcreatetransport",null)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0})}},{key:"_updateTransport",value:function(){y.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=o.default.parse(e),r={dtlsParameters:u.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),t}(),w=function(){function e(t,r,n){m(this,e),y.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r);var o=void 0;switch(t){case"send":return o={audio:c.getSendingRtpParameters("audio",r),video:c.getSendingRtpParameters("video",r)},new g(o,n);case"recv":return o={audio:c.getReceivingFullRtpParameters("audio",r),video:c.getReceivingFullRtpParameters("video",r)},new b(o,n)}}return n(e,null,[{key:"getNativeRtpCapabilities",value:function(){y.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});return e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(function(t){try{e.close()}catch(e){}var r=o.default.parse(t.sdp);return u.extractRtpCapabilities(r)}).catch(function(t){try{e.close()}catch(e){}throw t})}},{key:"tag",get:function(){return"ReactNative"}}]),e}();r.default=w},{"../EnhancedEventEmitter":4,"../Logger":5,"../ortc":23,"../utils":24,"./sdp/RemotePlanBSdp":17,"./sdp/commonUtils":19,"./sdp/planBUtils":20,"sdp-transform":33}],15:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=f(e("sdp-transform")),a=f(e("../Logger")),i=f(e("../EnhancedEventEmitter")),s=p(e("../utils")),c=p(e("../ortc")),u=p(e("./sdp/commonUtils")),d=p(e("./sdp/planBUtils")),l=f(e("./sdp/RemotePlanBSdp"));function p(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function f(e){return e&&e.__esModule?e:{default:e}}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var y=new a.default("Safari11"),_=function(e){function t(e,r,n){m(this,t);var o=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,y));return o._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),o._rtpParametersByKind=r,o._remoteSdp=new l.default(e,r),o._pc.addEventListener("iceconnectionstatechange",function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}}),o}return v(t,i.default),n(t,[{key:"close",value:function(){y.debug("close()");try{this._pc.close()}catch(e){}}}]),t}(),g=function(e){function t(e,r){m(this,t);var n=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"send",e,r));return n._transportReady=!1,n._stream=new MediaStream,n}return v(t,_),n(t,[{key:"addProducer",value:function(e){var t=this,r=e.track;if(y.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),this._stream.getTrackById(r.id))return Promise.reject(new Error("track already added"));var n=void 0,a=void 0;return Promise.resolve().then(function(){return t._stream.addTrack(r),n=t._pc.addTrack(r,t._stream),t._pc.createOffer()}).then(function(e){return y.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportReady)return t._setupTransport()}).then(function(){a=o.default.parse(t._pc.localDescription.sdp);var e={type:"answer",sdp:t._remoteSdp.createAnswerSdp(a)};return y.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){var n=s.clone(t._rtpParametersByKind[e.kind]);return d.fillRtpParametersForTrack(n,a,r),n}).catch(function(e){try{t._pc.removeTrack(n)}catch(e){}throw t._stream.removeTrack(r),e})}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return y.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then(function(){var e=t._pc.getSenders().find(function(e){return e.track===r});if(!e)throw new Error("RTCRtpSender found");return t._pc.removeTrack(e),t._stream.removeTrack(r),t._pc.createOffer()}).then(function(e){return y.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).catch(function(e){if(0!==t._stream.getTracks().length)throw e;y.warn("removeLocalTrack() | ignoring expected error due no sending tracks: %s",e.toString())}).then(function(){if("stable"!==t._pc.signalingState){var e=o.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return y.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}})}},{key:"replaceProducerTrack",value:function(e,t){var r=this;y.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return Promise.resolve().then(function(){var e=r._pc.getSenders().find(function(e){return e.track===n});if(!e)throw new Error("local track not found");return e.replaceTrack(t)}).then(function(){r._stream.removeTrack(n),r._stream.addTrack(t)})}},{key:"restartIce",value:function(e){var t=this;return y.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return t._pc.createOffer({iceRestart:!0})}).then(function(e){return y.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){var e=o.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return y.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)})}},{key:"_setupTransport",value:function(){var e=this;return y.debug("_setupTransport()"),Promise.resolve().then(function(){var t={},r=e._pc.localDescription.sdp,n=o.default.parse(r),a=u.extractDtlsParameters(n);return a.role="server",t.dtlsParameters=a,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0})}}]),t}(),b=function(e){function t(e,r){m(this,t);var n=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"recv",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._kinds=new Set,n._consumerInfos=new Map,n}return v(t,_),n(t,[{key:"addConsumer",value:function(e){var t=this;if(y.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={kind:e.kind,streamId:"recv-stream-"+e.id,trackId:"consumer-"+e.kind+"-"+e.id,ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),this._kinds.add(e.kind),Promise.resolve().then(function(){if(!t._transportCreated)return t._setupTransport()}).then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return y.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportUpdated)return t._updateTransport()}).then(function(){var e=t._pc.getReceivers().find(function(e){var t=e.track;return!!t&&t.id===o.trackId});if(!e)throw new Error("remote track not found");return e.track})}},{key:"removeConsumer",value:function(e){var t=this;return y.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return y.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return y.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return y.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var e=this;return y.debug("_setupTransport()"),Promise.resolve().then(function(){return e.safeEmitAsPromise("@needcreatetransport",null)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0})}},{key:"_updateTransport",value:function(){y.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=o.default.parse(e),r={dtlsParameters:u.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),t}(),w=function(){function e(t,r,n){m(this,e),y.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r);var o=void 0;switch(t){case"send":return o={audio:c.getSendingRtpParameters("audio",r),video:c.getSendingRtpParameters("video",r)},new g(o,n);case"recv":return o={audio:c.getReceivingFullRtpParameters("audio",r),video:c.getReceivingFullRtpParameters("video",r)},new b(o,n)}}return n(e,null,[{key:"getNativeRtpCapabilities",value:function(){y.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});return e.addTransceiver("audio"),e.addTransceiver("video"),e.createOffer().then(function(t){try{e.close()}catch(e){}var r=o.default.parse(t.sdp);return u.extractRtpCapabilities(r)}).catch(function(t){try{e.close()}catch(e){}throw t})}},{key:"tag",get:function(){return"Safari11"}}]),e}();r.default=w},{"../EnhancedEventEmitter":4,"../Logger":5,"../ortc":23,"../utils":24,"./sdp/RemotePlanBSdp":17,"./sdp/commonUtils":19,"./sdp/planBUtils":20,"sdp-transform":33}],16:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getCapabilities=function(){var e=RTCRtpReceiver.getCapabilities(),t=n.clone(e),r=!0,o=!1,a=void 0;try{for(var i,s=t.codecs[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var c=i.value;if(c.channels=c.numChannels,delete c.numChannels,"audio"!==c.kind?delete c.channels:c.channels||(c.channels=1),c.mimeType=c.kind+"/"+c.name,c.parameters){var u=c.parameters;u.apt&&(u.apt=Number(u.apt)),u["packetization-mode"]&&(u["packetization-mode"]=Number(u["packetization-mode"]))}var d=!0,l=!1,p=void 0;try{for(var f,m=(c.rtcpFeedback||[])[Symbol.iterator]();!(d=(f=m.next()).done);d=!0){var h=f.value;h.parameter||delete h.parameter}}catch(e){l=!0,p=e}finally{try{!d&&m.return&&m.return()}finally{if(l)throw p}}}}catch(e){o=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(o)throw a}}return t},r.mangleRtpParameters=function(e){var t=n.clone(e),r=!0,o=!1,a=void 0;try{for(var i,s=t.codecs[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var c=i.value;c.channels&&(c.numChannels=c.channels,delete c.channels),delete c.mimeType}}catch(e){o=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(o)throw a}}return t};var n=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}}(e("../../utils"))},{"../../utils":24}],17:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=s(e("sdp-transform")),a=s(e("../../Logger")),i=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}}(e("../../utils"));function s(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var l=new a.default("RemotePlanBSdp"),p=function(){function e(t){d(this,e),this._rtpParametersByKind=t,this._transportLocalParameters=null,this._transportRemoteParameters=null,this._sdpGlobalFields={id:i.randomNumber(),version:0}}return n(e,[{key:"setTransportLocalParameters",value:function(e){l.debug("setTransportLocalParameters() [transportLocalParameters:%o]",e),this._transportLocalParameters=e}},{key:"setTransportRemoteParameters",value:function(e){l.debug("setTransportRemoteParameters() [transportRemoteParameters:%o]",e),this._transportRemoteParameters=e}},{key:"updateTransportRemoteIceParameters",value:function(e){l.debug("updateTransportRemoteIceParameters() [remoteIceParameters:%o]",e),this._transportRemoteParameters.iceParameters=e}}]),e}(),f=function(e){function t(e){return d(this,t),c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return u(t,p),n(t,[{key:"createAnswerSdp",value:function(e){if(l.debug("createAnswerSdp()"),!this._transportLocalParameters)throw new Error("no transport local parameters");if(!this._transportRemoteParameters)throw new Error("no transport remote parameters");var t=this._transportRemoteParameters.iceParameters,r=this._transportRemoteParameters.iceCandidates,n=this._transportRemoteParameters.dtlsParameters,a={},i=(e.media||[]).map(function(e){return e.mid});this._sdpGlobalFields.version++,a.version=0,a.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},a.name="-",a.timing={start:0,stop:0},a.icelite=t.iceLite?"ice-lite":null,a.msidSemantic={semantic:"WMS",token:"*"},a.groups=[{type:"BUNDLE",mids:i.join(" ")}],a.media=[];var s=n.fingerprints.length;a.fingerprint={type:n.fingerprints[s-1].algorithm,hash:n.fingerprints[s-1].value};var c=!0,u=!1,d=void 0;try{for(var p,f=(e.media||[])[Symbol.iterator]();!(c=(p=f.next()).done);c=!0){var m=p.value,h=m.type,v=this._rtpParametersByKind[h].codecs,y=this._rtpParametersByKind[h].headerExtensions,_={};_.type=m.type,_.port=7,_.protocol="RTP/SAVPF",_.connection={ip:"127.0.0.1",version:4},_.mid=m.mid,_.iceUfrag=t.usernameFragment,_.icePwd=t.password,_.candidates=[];var g=!0,b=!1,w=void 0;try{for(var P,k=r[Symbol.iterator]();!(g=(P=k.next()).done);g=!0){var S=P.value,C={component:1};C.foundation=S.foundation,C.ip=S.ip,C.port=S.port,C.priority=S.priority,C.transport=S.protocol,C.type=S.type,S.tcpType&&(C.tcptype=S.tcpType),_.candidates.push(C)}}catch(e){b=!0,w=e}finally{try{!g&&k.return&&k.return()}finally{if(b)throw w}}switch(_.endOfCandidates="end-of-candidates",_.iceOptions="renomination",n.role){case"client":_.setup="active";break;case"server":_.setup="passive"}switch(m.direction){case"sendrecv":case"sendonly":_.direction="recvonly";break;case"recvonly":case"inactive":_.direction="inactive"}"video"===h&&(_.xGoogleFlag="conference"),_.rtp=[],_.rtcpFb=[],_.fmtp=[];var T=!0,E=!1,R=void 0;try{for(var x,O=v[Symbol.iterator]();!(T=(x=O.next()).done);T=!0){var j=x.value,I={payload:j.payloadType,codec:j.name,rate:j.clockRate};if(j.channels>1&&(I.encoding=j.channels),_.rtp.push(I),j.parameters){var D={payload:j.payloadType,config:""},F=!0,L=!1,A=void 0;try{for(var M,N=Object.keys(j.parameters)[Symbol.iterator]();!(F=(M=N.next()).done);F=!0){var B=M.value;D.config&&(D.config+=";"),D.config+=B+"="+j.parameters[B]}}catch(e){L=!0,A=e}finally{try{!F&&N.return&&N.return()}finally{if(L)throw A}}D.config&&_.fmtp.push(D)}if(j.rtcpFeedback){var U=!0,z=!1,G=void 0;try{for(var q,K=j.rtcpFeedback[Symbol.iterator]();!(U=(q=K.next()).done);U=!0){var V=q.value;_.rtcpFb.push({payload:j.payloadType,type:V.type,subtype:V.parameter||""})}}catch(e){z=!0,G=e}finally{try{!U&&K.return&&K.return()}finally{if(z)throw G}}}}}catch(e){E=!0,R=e}finally{try{!T&&O.return&&O.return()}finally{if(E)throw R}}_.payloads=v.map(function(e){return e.payloadType}).join(" "),_.ext=[];var W=function(e){if(!(m.ext||[]).find(function(t){return t.uri===e.uri}))return"continue";_.ext.push({uri:e.uri,value:e.id})},Q=!0,$=!1,J=void 0;try{for(var H,X=y[Symbol.iterator]();!(Q=(H=X.next()).done);Q=!0)W(H.value)}catch(e){$=!0,J=e}finally{try{!Q&&X.return&&X.return()}finally{if($)throw J}}_.rtcpMux="rtcp-mux",_.rtcpRsize="rtcp-rsize",a.media.push(_)}}catch(e){u=!0,d=e}finally{try{!c&&f.return&&f.return()}finally{if(u)throw d}}return o.default.write(a)}}]),t}(),m=function(e){function t(e){return d(this,t),c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return u(t,p),n(t,[{key:"createOfferSdp",value:function(e,t){var r=this;if(l.debug("createOfferSdp()"),!this._transportRemoteParameters)throw new Error("no transport remote parameters");var n=this._transportRemoteParameters.iceParameters,a=this._transportRemoteParameters.iceCandidates,i=this._transportRemoteParameters.dtlsParameters,s={},c=e;this._sdpGlobalFields.version++,s.version=0,s.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},s.name="-",s.timing={start:0,stop:0},s.icelite=n.iceLite?"ice-lite":null,s.msidSemantic={semantic:"WMS",token:"*"},s.groups=[{type:"BUNDLE",mids:c.join(" ")}],s.media=[];var u=i.fingerprints.length;s.fingerprint={type:i.fingerprints[u-1].algorithm,hash:i.fingerprints[u-1].value};var d=function(e){var o=r._rtpParametersByKind[e].codecs,i=r._rtpParametersByKind[e].headerExtensions,c={};c.type=e,c.port=7,c.protocol="RTP/SAVPF",c.connection={ip:"127.0.0.1",version:4},c.mid=e,c.iceUfrag=n.usernameFragment,c.icePwd=n.password,c.candidates=[];var u=!0,d=!1,l=void 0;try{for(var p,f=a[Symbol.iterator]();!(u=(p=f.next()).done);u=!0){var m=p.value,h={component:1};h.foundation=m.foundation,h.ip=m.ip,h.port=m.port,h.priority=m.priority,h.transport=m.protocol,h.type=m.type,m.tcpType&&(h.tcptype=m.tcpType),c.candidates.push(h)}}catch(e){d=!0,l=e}finally{try{!u&&f.return&&f.return()}finally{if(d)throw l}}c.endOfCandidates="end-of-candidates",c.iceOptions="renomination",c.setup="actpass",t.some(function(t){return t.kind===e})?c.direction="sendonly":c.direction="inactive",c.rtp=[],c.rtcpFb=[],c.fmtp=[];var v=!0,y=!1,_=void 0;try{for(var g,b=o[Symbol.iterator]();!(v=(g=b.next()).done);v=!0){var w=g.value,P={payload:w.payloadType,codec:w.name,rate:w.clockRate};if(w.channels>1&&(P.encoding=w.channels),c.rtp.push(P),w.parameters){var k={payload:w.payloadType,config:""},S=!0,C=!1,T=void 0;try{for(var E,R=Object.keys(w.parameters)[Symbol.iterator]();!(S=(E=R.next()).done);S=!0){var x=E.value;k.config&&(k.config+=";"),k.config+=x+"="+w.parameters[x]}}catch(e){C=!0,T=e}finally{try{!S&&R.return&&R.return()}finally{if(C)throw T}}k.config&&c.fmtp.push(k)}if(w.rtcpFeedback){var O=!0,j=!1,I=void 0;try{for(var D,F=w.rtcpFeedback[Symbol.iterator]();!(O=(D=F.next()).done);O=!0){var L=D.value;c.rtcpFb.push({payload:w.payloadType,type:L.type,subtype:L.parameter||""})}}catch(e){j=!0,I=e}finally{try{!O&&F.return&&F.return()}finally{if(j)throw I}}}}}catch(e){y=!0,_=e}finally{try{!v&&b.return&&b.return()}finally{if(y)throw _}}c.payloads=o.map(function(e){return e.payloadType}).join(" "),c.ext=[];var A=!0,M=!1,N=void 0;try{for(var B,U=i[Symbol.iterator]();!(A=(B=U.next()).done);A=!0){var z=B.value;c.ext.push({uri:z.uri,value:z.id})}}catch(e){M=!0,N=e}finally{try{!A&&U.return&&U.return()}finally{if(M)throw N}}c.rtcpMux="rtcp-mux",c.rtcpRsize="rtcp-rsize",c.ssrcs=[],c.ssrcGroups=[];var G=!0,q=!1,K=void 0;try{for(var V,W=t[Symbol.iterator]();!(G=(V=W.next()).done);G=!0){var Q=V.value;Q.kind===e&&(c.ssrcs.push({id:Q.ssrc,attribute:"msid",value:Q.streamId+" "+Q.trackId}),c.ssrcs.push({id:Q.ssrc,attribute:"mslabel",value:Q.streamId}),c.ssrcs.push({id:Q.ssrc,attribute:"label",value:Q.trackId}),c.ssrcs.push({id:Q.ssrc,attribute:"cname",value:Q.cname}),Q.rtxSsrc&&(c.ssrcs.push({id:Q.rtxSsrc,attribute:"msid",value:Q.streamId+" "+Q.trackId}),c.ssrcs.push({id:Q.rtxSsrc,attribute:"mslabel",value:Q.streamId}),c.ssrcs.push({id:Q.rtxSsrc,attribute:"label",value:Q.trackId}),c.ssrcs.push({id:Q.rtxSsrc,attribute:"cname",value:Q.cname}),c.ssrcGroups.push({semantics:"FID",ssrcs:Q.ssrc+" "+Q.rtxSsrc})))}}catch(e){q=!0,K=e}finally{try{!G&&W.return&&W.return()}finally{if(q)throw K}}s.media.push(c)},p=!0,f=!1,m=void 0;try{for(var h,v=e[Symbol.iterator]();!(p=(h=v.next()).done);p=!0){d(h.value)}}catch(e){f=!0,m=e}finally{try{!p&&v.return&&v.return()}finally{if(f)throw m}}return o.default.write(s)}}]),t}();r.default=function e(t,r){switch(d(this,e),l.debug("constructor() [direction:%s, rtpParametersByKind:%o]",t,r),t){case"send":return new f(r);case"recv":return new m(r)}}},{"../../Logger":5,"../../utils":24,"sdp-transform":33}],18:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=s(e("sdp-transform")),a=s(e("../../Logger")),i=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}}(e("../../utils"));function s(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var l=new a.default("RemoteUnifiedPlanSdp"),p=function(){function e(t){d(this,e),this._rtpParametersByKind=t,this._transportLocalParameters=null,this._transportRemoteParameters=null,this._sdpGlobalFields={id:i.randomNumber(),version:0}}return n(e,[{key:"setTransportLocalParameters",value:function(e){l.debug("setTransportLocalParameters() [transportLocalParameters:%o]",e),this._transportLocalParameters=e}},{key:"setTransportRemoteParameters",value:function(e){l.debug("setTransportRemoteParameters() [transportRemoteParameters:%o]",e),this._transportRemoteParameters=e}},{key:"updateTransportRemoteIceParameters",value:function(e){l.debug("updateTransportRemoteIceParameters() [remoteIceParameters:%o]",e),this._transportRemoteParameters.iceParameters=e}}]),e}(),f=function(e){function t(e){return d(this,t),c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return u(t,p),n(t,[{key:"createAnswerSdp",value:function(e){if(l.debug("createAnswerSdp()"),!this._transportLocalParameters)throw new Error("no transport local parameters");if(!this._transportRemoteParameters)throw new Error("no transport remote parameters");var t=this._transportRemoteParameters.iceParameters,r=this._transportRemoteParameters.iceCandidates,n=this._transportRemoteParameters.dtlsParameters,a={},i=(e.media||[]).filter(function(e){return e.mid}).map(function(e){return e.mid});this._sdpGlobalFields.version++,a.version=0,a.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},a.name="-",a.timing={start:0,stop:0},a.icelite=t.iceLite?"ice-lite":null,a.msidSemantic={semantic:"WMS",token:"*"},i.length>0&&(a.groups=[{type:"BUNDLE",mids:i.join(" ")}]),a.media=[];var s=n.fingerprints.length;a.fingerprint={type:n.fingerprints[s-1].algorithm,hash:n.fingerprints[s-1].value};var c=!0,u=!1,d=void 0;try{for(var p,f=(e.media||[])[Symbol.iterator]();!(c=(p=f.next()).done);c=!0){var m=p.value,h="inactive"===m.direction,v=m.type,y=this._rtpParametersByKind[v].codecs,_=this._rtpParametersByKind[v].headerExtensions,g={};g.type=m.type,g.port=7,g.protocol="RTP/SAVPF",g.connection={ip:"127.0.0.1",version:4},g.mid=m.mid,g.iceUfrag=t.usernameFragment,g.icePwd=t.password,g.candidates=[];var b=!0,w=!1,P=void 0;try{for(var k,S=r[Symbol.iterator]();!(b=(k=S.next()).done);b=!0){var C=k.value,T={component:1};T.foundation=C.foundation,T.ip=C.ip,T.port=C.port,T.priority=C.priority,T.transport=C.protocol,T.type=C.type,C.tcpType&&(T.tcptype=C.tcpType),g.candidates.push(T)}}catch(e){w=!0,P=e}finally{try{!b&&S.return&&S.return()}finally{if(w)throw P}}switch(g.endOfCandidates="end-of-candidates",g.iceOptions="renomination",n.role){case"client":g.setup="active";break;case"server":g.setup="passive"}switch(m.direction){case"sendrecv":case"sendonly":g.direction="recvonly";break;case"recvonly":case"inactive":g.direction="inactive"}g.rtp=[],g.rtcpFb=[],g.fmtp=[];var E=!0,R=!1,x=void 0;try{for(var O,j=y[Symbol.iterator]();!(E=(O=j.next()).done);E=!0){var I=O.value,D={payload:I.payloadType,codec:I.name,rate:I.clockRate};if(I.channels>1&&(D.encoding=I.channels),g.rtp.push(D),I.parameters){var F={payload:I.payloadType,config:""},L=!0,A=!1,M=void 0;try{for(var N,B=Object.keys(I.parameters)[Symbol.iterator]();!(L=(N=B.next()).done);L=!0){var U=N.value;F.config&&(F.config+=";"),F.config+=U+"="+I.parameters[U]}}catch(e){A=!0,M=e}finally{try{!L&&B.return&&B.return()}finally{if(A)throw M}}F.config&&g.fmtp.push(F)}if(I.rtcpFeedback){var z=!0,G=!1,q=void 0;try{for(var K,V=I.rtcpFeedback[Symbol.iterator]();!(z=(K=V.next()).done);z=!0){var W=K.value;g.rtcpFb.push({payload:I.payloadType,type:W.type,subtype:W.parameter||""})}}catch(e){G=!0,q=e}finally{try{!z&&V.return&&V.return()}finally{if(G)throw q}}}}}catch(e){R=!0,x=e}finally{try{!E&&j.return&&j.return()}finally{if(R)throw x}}if(g.payloads=y.map(function(e){return e.payloadType}).join(" "),!h){g.ext=[];var Q=function(e){if(!(m.ext||[]).find(function(t){return t.uri===e.uri}))return"continue";g.ext.push({uri:e.uri,value:e.id})},$=!0,J=!1,H=void 0;try{for(var X,Z=_[Symbol.iterator]();!($=(X=Z.next()).done);$=!0)Q(X.value)}catch(e){J=!0,H=e}finally{try{!$&&Z.return&&Z.return()}finally{if(J)throw H}}}if(m.simulcast_03){g.simulcast_03={value:m.simulcast_03.value.replace(/send/g,"recv")},g.rids=[];var Y=!0,ee=!1,te=void 0;try{for(var re,ne=(m.rids||[])[Symbol.iterator]();!(Y=(re=ne.next()).done);Y=!0){var oe=re.value;"send"===oe.direction&&g.rids.push({id:oe.id,direction:"recv"})}}catch(e){ee=!0,te=e}finally{try{!Y&&ne.return&&ne.return()}finally{if(ee)throw te}}}g.rtcpMux="rtcp-mux",g.rtcpRsize="rtcp-rsize",a.media.push(g)}}catch(e){u=!0,d=e}finally{try{!c&&f.return&&f.return()}finally{if(u)throw d}}return o.default.write(a)}}]),t}(),m=function(e){function t(e){return d(this,t),c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return u(t,p),n(t,[{key:"createOfferSdp",value:function(e){if(l.debug("createOfferSdp()"),!this._transportRemoteParameters)throw new Error("no transport remote parameters");var t=this._transportRemoteParameters.iceParameters,r=this._transportRemoteParameters.iceCandidates,n=this._transportRemoteParameters.dtlsParameters,a={},i=e.filter(function(e){return!e.closed}).map(function(e){return e.mid});this._sdpGlobalFields.version++,a.version=0,a.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},a.name="-",a.timing={start:0,stop:0},a.icelite=t.iceLite?"ice-lite":null,a.msidSemantic={semantic:"WMS",token:"*"},i.length>0&&(a.groups=[{type:"BUNDLE",mids:i.join(" ")}]),a.media=[];var s=n.fingerprints.length;a.fingerprint={type:n.fingerprints[s-1].algorithm,hash:n.fingerprints[s-1].value};var c=!0,u=!1,d=void 0;try{for(var p,f=e[Symbol.iterator]();!(c=(p=f.next()).done);c=!0){var m=p.value,h=m.closed,v=m.kind,y=void 0,_=void 0;"application"!==m.kind&&(y=this._rtpParametersByKind[v].codecs,_=this._rtpParametersByKind[v].headerExtensions);var g={};"application"!==m.kind?(g.type=v,g.port=7,g.protocol="RTP/SAVPF",g.connection={ip:"127.0.0.1",version:4},g.mid=m.mid,g.msid=m.streamId+" "+m.trackId):(g.type=v,g.port=9,g.protocol="DTLS/SCTP",g.connection={ip:"127.0.0.1",version:4},g.mid=m.mid),g.iceUfrag=t.usernameFragment,g.icePwd=t.password,g.candidates=[];var b=!0,w=!1,P=void 0;try{for(var k,S=r[Symbol.iterator]();!(b=(k=S.next()).done);b=!0){var C=k.value,T={component:1};T.foundation=C.foundation,T.ip=C.ip,T.port=C.port,T.priority=C.priority,T.transport=C.protocol,T.type=C.type,C.tcpType&&(T.tcptype=C.tcpType),g.candidates.push(T)}}catch(e){w=!0,P=e}finally{try{!b&&S.return&&S.return()}finally{if(w)throw P}}if(g.endOfCandidates="end-of-candidates",g.iceOptions="renomination",g.setup="actpass","application"!==m.kind){g.direction=h?"inactive":"sendonly",g.rtp=[],g.rtcpFb=[],g.fmtp=[];var E=!0,R=!1,x=void 0;try{for(var O,j=y[Symbol.iterator]();!(E=(O=j.next()).done);E=!0){var I=O.value,D={payload:I.payloadType,codec:I.name,rate:I.clockRate};if(I.channels>1&&(D.encoding=I.channels),g.rtp.push(D),I.parameters){var F={payload:I.payloadType,config:""},L=!0,A=!1,M=void 0;try{for(var N,B=Object.keys(I.parameters)[Symbol.iterator]();!(L=(N=B.next()).done);L=!0){var U=N.value;F.config&&(F.config+=";"),F.config+=U+"="+I.parameters[U]}}catch(e){A=!0,M=e}finally{try{!L&&B.return&&B.return()}finally{if(A)throw M}}F.config&&g.fmtp.push(F)}if(I.rtcpFeedback){var z=!0,G=!1,q=void 0;try{for(var K,V=I.rtcpFeedback[Symbol.iterator]();!(z=(K=V.next()).done);z=!0){var W=K.value;g.rtcpFb.push({payload:I.payloadType,type:W.type,subtype:W.parameter||""})}}catch(e){G=!0,q=e}finally{try{!z&&V.return&&V.return()}finally{if(G)throw q}}}}}catch(e){R=!0,x=e}finally{try{!E&&j.return&&j.return()}finally{if(R)throw x}}if(g.payloads=y.map(function(e){return e.payloadType}).join(" "),!h){g.ext=[];var Q=!0,$=!1,J=void 0;try{for(var H,X=_[Symbol.iterator]();!(Q=(H=X.next()).done);Q=!0){var Z=H.value;g.ext.push({uri:Z.uri,value:Z.id})}}catch(e){$=!0,J=e}finally{try{!Q&&X.return&&X.return()}finally{if($)throw J}}}g.rtcpMux="rtcp-mux",g.rtcpRsize="rtcp-rsize",h||(g.ssrcs=[],g.ssrcGroups=[],g.ssrcs.push({id:m.ssrc,attribute:"cname",value:m.cname}),m.rtxSsrc&&(g.ssrcs.push({id:m.rtxSsrc,attribute:"cname",value:m.cname}),g.ssrcGroups.push({semantics:"FID",ssrcs:m.ssrc+" "+m.rtxSsrc})))}else g.payloads=5e3,g.sctpmap={app:"webrtc-datachannel",maxMessageSize:256,sctpmapNumber:5e3};a.media.push(g)}}catch(e){u=!0,d=e}finally{try{!c&&f.return&&f.return()}finally{if(u)throw d}}return o.default.write(a)}}]),t}();r.default=function e(t,r){switch(d(this,e),l.debug("constructor() [direction:%s, rtpParametersByKind:%o]",t,r),t){case"send":return new f(r);case"recv":return new m(r)}}},{"../../Logger":5,"../../utils":24,"sdp-transform":33}],19:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.extractRtpCapabilities=function(e){var t=new Map,r=[],n=!1,o=!1,i=!0,s=!1,c=void 0;try{for(var u,d=e.media[Symbol.iterator]();!(i=(u=d.next()).done);i=!0){var l=u.value,p=l.type;switch(p){case"audio":if(n)continue;n=!0;break;case"video":if(o)continue;o=!0;break;default:continue}var f=!0,m=!1,h=void 0;try{for(var v,y=l.rtp[Symbol.iterator]();!(f=(v=y.next()).done);f=!0){var _=v.value,g={name:_.codec,mimeType:p+"/"+_.codec,kind:p,clockRate:_.rate,preferredPayloadType:_.payload,channels:_.encoding,rtcpFeedback:[],parameters:{}};"audio"!==g.kind?delete g.channels:g.channels||(g.channels=1),t.set(g.preferredPayloadType,g)}}catch(e){m=!0,h=e}finally{try{!f&&y.return&&y.return()}finally{if(m)throw h}}var b=!0,w=!1,P=void 0;try{for(var k,S=(l.fmtp||[])[Symbol.iterator]();!(b=(k=S.next()).done);b=!0){var C=k.value,T=a.default.parseFmtpConfig(C.config),g=t.get(C.payload);g&&(g.parameters=T)}}catch(e){w=!0,P=e}finally{try{!b&&S.return&&S.return()}finally{if(w)throw P}}var E=!0,R=!1,x=void 0;try{for(var O,j=(l.rtcpFb||[])[Symbol.iterator]();!(E=(O=j.next()).done);E=!0){var I=O.value,g=t.get(I.payload);if(g){var D={type:I.type,parameter:I.subtype};D.parameter||delete D.parameter,g.rtcpFeedback.push(D)}}}catch(e){R=!0,x=e}finally{try{!E&&j.return&&j.return()}finally{if(R)throw x}}var F=!0,L=!1,A=void 0;try{for(var M,N=(l.ext||[])[Symbol.iterator]();!(F=(M=N.next()).done);F=!0){var B=M.value,U={kind:p,uri:B.uri,preferredId:B.value};r.push(U)}}catch(e){L=!0,A=e}finally{try{!F&&N.return&&N.return()}finally{if(L)throw A}}}}catch(e){s=!0,c=e}finally{try{!i&&d.return&&d.return()}finally{if(s)throw c}}return{codecs:Array.from(t.values()),headerExtensions:r,fecMechanisms:[]}},r.extractDtlsParameters=function(e){var t=(o=e,(o.media||[]).find(function(e){return e.iceUfrag&&0!==e.port})),r=t.fingerprint||e.fingerprint,n=void 0;var o;switch(t.setup){case"active":n="client";break;case"passive":n="server";break;case"actpass":n="auto"}return{role:n,fingerprints:[{algorithm:r.type,value:r.hash}]}};var n,o=e("sdp-transform"),a=(n=o)&&n.__esModule?n:{default:n}},{"sdp-transform":33}],20:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();r.fillRtpParametersForTrack=function(e,t,r){var o=r.kind,a={cname:null,reducedSize:!0,mux:!0},i=(t.media||[]).find(function(e){return e.type===o});if(!i)throw new Error("m="+o+" section not found");var s=void 0,c=new Set,u=!0,d=!1,l=void 0;try{for(var p,f=(i.ssrcs||[])[Symbol.iterator]();!(u=(p=f.next()).done);u=!0){var m=p.value;if("msid"===m.attribute){var h=m.value.split(" ")[1];if(h===r.id){var v=m.id;c.add(v),s||(s=v)}}}}catch(e){d=!0,l=e}finally{try{!u&&f.return&&f.return()}finally{if(d)throw l}}if(0===c.size)throw new Error("a=ssrc line not found for local track [track.id:"+r.id+"]");var y=new Map,_=!0,g=!1,b=void 0;try{for(var w,P=(i.ssrcGroups||[])[Symbol.iterator]();!(_=(w=P.next()).done);_=!0){var k=w.value;if("FID"===k.semantics){var S=k.ssrcs.split(/\s+/),C=n(S,2),T=C[0],E=C[1];T=Number(T),E=Number(E),c.has(T)&&(c.delete(T),c.delete(E),y.set(T,E))}}}catch(e){g=!0,b=e}finally{try{!_&&P.return&&P.return()}finally{if(g)throw b}}var R=!0,x=!1,O=void 0;try{for(var j,I=c[Symbol.iterator]();!(R=(j=I.next()).done);R=!0){var T=j.value;y.set(T,null)}}catch(e){x=!0,O=e}finally{try{!R&&I.return&&I.return()}finally{if(x)throw O}}var D=i.ssrcs.find(function(e){return"cname"===e.attribute&&e.id===s});D&&(a.cname=D.value);e.rtcp=a,e.encodings=[];var F=y.size>1,L=["low","medium","high"],A=!0,M=!1,N=void 0;try{for(var B,U=y[Symbol.iterator]();!(A=(B=U.next()).done);A=!0){var z=B.value,G=n(z,2),q=G[0],E=G[1],K={ssrc:q};E&&(K.rtx={ssrc:E}),F&&(K.profile=L.shift()),e.encodings.push(K)}}catch(e){M=!0,N=e}finally{try{!A&&U.return&&U.return()}finally{if(M)throw N}}},r.addSimulcastForTrack=function(e,t){var r=t.kind,n=(e.media||[]).find(function(e){return e.type===r});if(!n)throw new Error("m="+r+" section not found");var o=void 0,a=void 0,i=void 0;if(!(n.ssrcs||[]).find(function(e){if("msid"!==e.attribute)return!1;var r=e.value.split(" ")[1];return r===t.id?(o=e.id,i=e.value.split(" ")[0],!0):void 0}))throw new Error("a=ssrc line not found for local track [track.id:"+t.id+"]");(n.ssrcGroups||[]).some(function(e){if("FID"===e.semantics){var t=e.ssrcs.split(/\s+/);return Number(t[0])===o?(a=Number(t[1]),!0):void 0}});var s=n.ssrcs.find(function(e){return"cname"===e.attribute&&e.id===o});if(!s)throw new Error("CNAME line not found for local track [track.id:"+t.id+"]");var c=s.value,u=o+1,d=o+2;if(n.ssrcGroups=n.ssrcGroups||[],n.ssrcGroups.push({semantics:"SIM",ssrcs:o+" "+u+" "+d}),n.ssrcs.push({id:u,attribute:"cname",value:c}),n.ssrcs.push({id:u,attribute:"msid",value:i+" "+t.id}),n.ssrcs.push({id:d,attribute:"cname",value:c}),n.ssrcs.push({id:d,attribute:"msid",value:i+" "+t.id}),a){var l=a+1,p=a+2;n.ssrcGroups.push({semantics:"FID",ssrcs:u+" "+l}),n.ssrcs.push({id:l,attribute:"cname",value:c}),n.ssrcs.push({id:l,attribute:"msid",value:i+" "+t.id}),n.ssrcGroups.push({semantics:"FID",ssrcs:d+" "+p}),n.ssrcs.push({id:p,attribute:"cname",value:c}),n.ssrcs.push({id:p,attribute:"msid",value:i+" "+t.id})}}},{}],21:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.fillRtpParametersForTrack=function(e,t,r){var n=r.kind,o={cname:null,reducedSize:!0,mux:!0},a=(t.media||[]).find(function(e){if(e.type===n){var t=e.msid;if(t){var o=t.split(" ")[1];return o===r.id||void 0}}});if(!a)throw new Error("m="+n+" section not found");var i=(a.ssrcs||[]).find(function(e){return"cname"===e.attribute}),s=void 0;i&&(s=i.id,o.cname=i.value);var c=[],u=!0,d=!1,l=void 0;try{for(var p,f=(a.rids||[])[Symbol.iterator]();!(u=(p=f.next()).done);u=!0){var m=p.value;"send"===m.direction&&(/^low/.test(m.id)?c.push({rid:m.id,profile:"low"}):/^medium/.test(m.id)&&c.push({rid:m.id,profile:"medium"}),/^high/.test(m.id)&&c.push({rid:m.id,profile:"high"}))}}catch(e){d=!0,l=e}finally{try{!u&&f.return&&f.return()}finally{if(d)throw l}}if(e.rtcp=o,e.encodings=[],0===c.length){var h={ssrc:s};e.encodings.push(h)}else{var v=!0,y=!1,_=void 0;try{for(var g,b=c[Symbol.iterator]();!(v=(g=b.next()).done);v=!0){var w=g.value,P={encodingId:w.rid,profile:w.profile};e.encodings.push(P)}}catch(e){y=!0,_=e}finally{try{!v&&b.return&&b.return()}finally{if(y)throw _}}}}},{}],22:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Room=void 0,r.isDeviceSupported=function(){return o.default.isSupported()},r.getDeviceInfo=function(){return{flag:o.default.getFlag(),name:o.default.getName(),version:o.default.getVersion(),bowser:o.default.getBowser()}},r.checkCapabilitiesForRoom=function(e){return o.default.isSupported()?o.default.Handler.getNativeRtpCapabilities().then(function(t){var r=n.getExtendedRtpCapabilities(t,e);return{audio:n.canSend("audio",r),video:n.canSend("video",r)}}):Promise.reject(new Error("current browser/device not supported"))};var n=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}}(e("./ortc")),o=i(e("./Device")),a=i(e("./Room"));function i(e){return e&&e.__esModule?e:{default:e}}r.Room=a.default},{"./Device":3,"./Room":8,"./ortc":23}],23:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getExtendedRtpCapabilities=function(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},n=function(t){if("rtx"===t.name)return"continue";var n=(e.codecs||[]).find(function(e){return function(e,t){var r=e.mimeType.toLowerCase(),n=t.mimeType.toLowerCase();if(r!==n)return!1;if(e.clockRate!==t.clockRate)return!1;if(e.channels!==t.channels)return!1;if("video/h264"===r){var o=(e.parameters||{})["packetization-mode"]||0,a=(t.parameters||{})["packetization-mode"]||0;if(o!==a)return!1}return!0}(e,t)});if(n){var o={name:t.name,mimeType:t.mimeType,kind:t.kind,clockRate:t.clockRate,sendPayloadType:n.preferredPayloadType,sendRtxPayloadType:null,recvPayloadType:t.preferredPayloadType,recvRtxPayloadType:null,channels:t.channels,rtcpFeedback:function(e,t){var r=[],n=function(e){var n=(t.rtcpFeedback||[]).find(function(t){return t.type===e.type&&t.parameter===e.parameter});n&&r.push(n)},o=!0,a=!1,i=void 0;try{for(var s,c=(e.rtcpFeedback||[])[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){var u=s.value;n(u)}}catch(e){a=!0,i=e}finally{try{!o&&c.return&&c.return()}finally{if(a)throw i}}return r}(n,t),parameters:t.parameters};o.channels||delete o.channels,r.codecs.push(o)}},o=!0,a=!1,i=void 0;try{for(var s,c=(t.codecs||[])[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){var u=s.value;n(u)}}catch(e){a=!0,i=e}finally{try{!o&&c.return&&c.return()}finally{if(a)throw i}}var d=function(r){var n=(e.codecs||[]).find(function(e){return"rtx"===e.name&&e.parameters.apt===r.sendPayloadType}),o=(t.codecs||[]).find(function(e){return"rtx"===e.name&&e.parameters.apt===r.recvPayloadType});n&&o&&(r.sendRtxPayloadType=n.preferredPayloadType,r.recvRtxPayloadType=o.preferredPayloadType)},l=!0,p=!1,f=void 0;try{for(var m,h=(r.codecs||[])[Symbol.iterator]();!(l=(m=h.next()).done);l=!0){var v=m.value;d(v)}}catch(e){p=!0,f=e}finally{try{!l&&h.return&&h.return()}finally{if(p)throw f}}var y=function(t){var n=(e.headerExtensions||[]).find(function(e){return n=t,!((r=e).kind&&n.kind&&r.kind!==n.kind||r.uri!==n.uri);var r,n});if(n){var o={kind:t.kind,uri:t.uri,sendId:n.preferredId,recvId:t.preferredId};r.headerExtensions.push(o)}},_=!0,g=!1,b=void 0;try{for(var w,P=(t.headerExtensions||[])[Symbol.iterator]();!(_=(w=P.next()).done);_=!0){var k=w.value;y(k)}}catch(e){g=!0,b=e}finally{try{!_&&P.return&&P.return()}finally{if(g)throw b}}return r},r.getRtpCapabilities=function(e){var t={codecs:[],headerExtensions:[],fecMechanisms:[]},r=!0,n=!1,o=void 0;try{for(var a,i=e.codecs[Symbol.iterator]();!(r=(a=i.next()).done);r=!0){var s=a.value,c={name:s.name,mimeType:s.mimeType,kind:s.kind,clockRate:s.clockRate,preferredPayloadType:s.recvPayloadType,channels:s.channels,rtcpFeedback:s.rtcpFeedback,parameters:s.parameters};if(c.channels||delete c.channels,t.codecs.push(c),s.recvRtxPayloadType){var u={name:"rtx",mimeType:s.kind+"/rtx",kind:s.kind,clockRate:s.clockRate,preferredPayloadType:s.recvRtxPayloadType,parameters:{apt:s.recvPayloadType}};t.codecs.push(u)}}}catch(e){n=!0,o=e}finally{try{!r&&i.return&&i.return()}finally{if(n)throw o}}var d=!0,l=!1,p=void 0;try{for(var f,m=e.headerExtensions[Symbol.iterator]();!(d=(f=m.next()).done);d=!0){var h=f.value,v={kind:h.kind,uri:h.uri,preferredId:h.recvId};t.headerExtensions.push(v)}}catch(e){l=!0,p=e}finally{try{!d&&m.return&&m.return()}finally{if(l)throw p}}return t.fecMechanisms=e.fecMechanisms,t},r.getUnsupportedCodecs=function(e,t,r){if(!Array.isArray(t))return[];var n=[],o=e.codecs,a=r.codecs,i=function(e){if(!a.some(function(t){return t.recvPayloadType===e})){var t=o.find(function(t){return t.preferredPayloadType===e});if(!t)throw new Error("mandatory codec PT "+e+" not found in remote codecs");n.push(t)}},s=!0,c=!1,u=void 0;try{for(var d,l=t[Symbol.iterator]();!(s=(d=l.next()).done);s=!0){var p=d.value;i(p)}}catch(e){c=!0,u=e}finally{try{!s&&l.return&&l.return()}finally{if(c)throw u}}return n},r.canSend=function(e,t){return t.codecs.some(function(t){return t.kind===e})},r.canReceive=function(e,t){if(0===e.codecs.length)return!1;var r=e.codecs[0];return t.codecs.some(function(e){return e.recvPayloadType===r.payloadType})},r.getSendingRtpParameters=function(e,t){var r={muxId:null,codecs:[],headerExtensions:[],encodings:[],rtcp:{}},n=!0,o=!1,a=void 0;try{for(var i,s=t.codecs[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var c=i.value;if(c.kind===e){var u={name:c.name,mimeType:c.mimeType,clockRate:c.clockRate,payloadType:c.sendPayloadType,channels:c.channels,rtcpFeedback:c.rtcpFeedback,parameters:c.parameters};if(u.channels||delete u.channels,r.codecs.push(u),c.sendRtxPayloadType){var d={name:"rtx",mimeType:c.kind+"/rtx",clockRate:c.clockRate,payloadType:c.sendRtxPayloadType,parameters:{apt:c.sendPayloadType}};r.codecs.push(d)}break}}}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}var l=!0,p=!1,f=void 0;try{for(var m,h=t.headerExtensions[Symbol.iterator]();!(l=(m=h.next()).done);l=!0){var v=m.value;if(!v.kind||v.kind===e){var y={uri:v.uri,id:v.sendId};r.headerExtensions.push(y)}}}catch(e){p=!0,f=e}finally{try{!l&&h.return&&h.return()}finally{if(p)throw f}}return r},r.getReceivingFullRtpParameters=function(e,t){var r={muxId:null,codecs:[],headerExtensions:[],encodings:[],rtcp:{}},n=!0,o=!1,a=void 0;try{for(var i,s=t.codecs[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var c=i.value;if(c.kind===e){var u={name:c.name,mimeType:c.mimeType,clockRate:c.clockRate,payloadType:c.recvPayloadType,channels:c.channels,rtcpFeedback:c.rtcpFeedback,parameters:c.parameters};if(u.channels||delete u.channels,r.codecs.push(u),c.recvRtxPayloadType){var d={name:"rtx",mimeType:c.kind+"/rtx",clockRate:c.clockRate,payloadType:c.recvRtxPayloadType,parameters:{apt:c.recvPayloadType}};r.codecs.push(d)}}}}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}var l=!0,p=!1,f=void 0;try{for(var m,h=t.headerExtensions[Symbol.iterator]();!(l=(m=h.next()).done);l=!0){var v=m.value;if(!v.kind||v.kind===e){var y={uri:v.uri,id:v.recvId};r.headerExtensions.push(y)}}}catch(e){p=!0,f=e}finally{try{!l&&h.return&&h.return()}finally{if(p)throw f}}return r}},{}],24:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.randomNumber=function(){return a()},r.clone=function(e){return JSON.parse(JSON.stringify(e))};var n,o=e("random-number");var a=((n=o)&&n.__esModule?n:{default:n}).default.generator({min:1e7,max:99999999,integer:!0})},{"random-number":31}],25:[function(e,t,r){var n,o;n=this,o=function(){var e=!0;function t(t){function r(e){var r=t.match(e);return r&&r.length>1&&r[1]||""}function n(e){var r=t.match(e);return r&&r.length>1&&r[2]||""}var o,a=r(/(ipod|iphone|ipad)/i).toLowerCase(),i=!/like android/i.test(t)&&/android/i.test(t),s=/nexus\s*[0-6]\s*/i.test(t),c=!s&&/nexus\s*[0-9]+/i.test(t),u=/CrOS/.test(t),d=/silk/i.test(t),l=/sailfish/i.test(t),p=/tizen/i.test(t),f=/(web|hpw)os/i.test(t),m=/windows phone/i.test(t),h=(/SamsungBrowser/i.test(t),!m&&/windows/i.test(t)),v=!a&&!d&&/macintosh/i.test(t),y=!i&&!l&&!p&&!f&&/linux/i.test(t),_=n(/edg([ea]|ios)\/(\d+(\.\d+)?)/i),g=r(/version\/(\d+(\.\d+)?)/i),b=/tablet/i.test(t)&&!/tablet pc/i.test(t),w=!b&&/[^-]mobi/i.test(t),P=/xbox/i.test(t);/opera/i.test(t)?o={name:"Opera",opera:e,version:g||r(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/opr\/|opios/i.test(t)?o={name:"Opera",opera:e,version:r(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||g}:/SamsungBrowser/i.test(t)?o={name:"Samsung Internet for Android",samsungBrowser:e,version:g||r(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}:/coast/i.test(t)?o={name:"Opera Coast",coast:e,version:g||r(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/yabrowser/i.test(t)?o={name:"Yandex Browser",yandexbrowser:e,version:g||r(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(t)?o={name:"UC Browser",ucbrowser:e,version:r(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(t)?o={name:"Maxthon",maxthon:e,version:r(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(t)?o={name:"Epiphany",epiphany:e,version:r(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(t)?o={name:"Puffin",puffin:e,version:r(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(t)?o={name:"Sleipnir",sleipnir:e,version:r(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(t)?o={name:"K-Meleon",kMeleon:e,version:r(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:m?(o={name:"Windows Phone",osname:"Windows Phone",windowsphone:e},_?(o.msedge=e,o.version=_):(o.msie=e,o.version=r(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(t)?o={name:"Internet Explorer",msie:e,version:r(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:u?o={name:"Chrome",osname:"Chrome OS",chromeos:e,chromeBook:e,chrome:e,version:r(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/edg([ea]|ios)/i.test(t)?o={name:"Microsoft Edge",msedge:e,version:_}:/vivaldi/i.test(t)?o={name:"Vivaldi",vivaldi:e,version:r(/vivaldi\/(\d+(\.\d+)?)/i)||g}:l?o={name:"Sailfish",osname:"Sailfish OS",sailfish:e,version:r(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(t)?o={name:"SeaMonkey",seamonkey:e,version:r(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(t)?(o={name:"Firefox",firefox:e,version:r(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(t)&&(o.firefoxos=e,o.osname="Firefox OS")):d?o={name:"Amazon Silk",silk:e,version:r(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(t)?o={name:"PhantomJS",phantom:e,version:r(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(t)?o={name:"SlimerJS",slimer:e,version:r(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(t)||/rim\stablet/i.test(t)?o={name:"BlackBerry",osname:"BlackBerry OS",blackberry:e,version:g||r(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:f?(o={name:"WebOS",osname:"WebOS",webos:e,version:g||r(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(t)&&(o.touchpad=e)):/bada/i.test(t)?o={name:"Bada",osname:"Bada",bada:e,version:r(/dolfin\/(\d+(\.\d+)?)/i)}:p?o={name:"Tizen",osname:"Tizen",tizen:e,version:r(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||g}:/qupzilla/i.test(t)?o={name:"QupZilla",qupzilla:e,version:r(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||g}:/chromium/i.test(t)?o={name:"Chromium",chromium:e,version:r(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||g}:/chrome|crios|crmo/i.test(t)?o={name:"Chrome",chrome:e,version:r(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:i?o={name:"Android",version:g}:/safari|applewebkit/i.test(t)?(o={name:"Safari",safari:e},g&&(o.version=g)):a?(o={name:"iphone"==a?"iPhone":"ipad"==a?"iPad":"iPod"},g&&(o.version=g)):o=/googlebot/i.test(t)?{name:"Googlebot",googlebot:e,version:r(/googlebot\/(\d+(\.\d+))/i)||g}:{name:r(/^(.*)\/(.*) /),version:n(/^(.*)\/(.*) /)},!o.msedge&&/(apple)?webkit/i.test(t)?(/(apple)?webkit\/537\.36/i.test(t)?(o.name=o.name||"Blink",o.blink=e):(o.name=o.name||"Webkit",o.webkit=e),!o.version&&g&&(o.version=g)):!o.opera&&/gecko\//i.test(t)&&(o.name=o.name||"Gecko",o.gecko=e,o.version=o.version||r(/gecko\/(\d+(\.\d+)?)/i)),o.windowsphone||!i&&!o.silk?!o.windowsphone&&a?(o[a]=e,o.ios=e,o.osname="iOS"):v?(o.mac=e,o.osname="macOS"):P?(o.xbox=e,o.osname="Xbox"):h?(o.windows=e,o.osname="Windows"):y&&(o.linux=e,o.osname="Linux"):(o.android=e,o.osname="Android");var k="";o.windows?k=function(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}(r(/Windows ((NT|XP)( \d\d?.\d)?)/i)):o.windowsphone?k=r(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):o.mac?k=(k=r(/Mac OS X (\d+([_\.\s]\d+)*)/i)).replace(/[_\s]/g,"."):a?k=(k=r(/os (\d+([_\s]\d+)*) like mac os x/i)).replace(/[_\s]/g,"."):i?k=r(/android[ \/-](\d+(\.\d+)*)/i):o.webos?k=r(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):o.blackberry?k=r(/rim\stablet\sos\s(\d+(\.\d+)*)/i):o.bada?k=r(/bada\/(\d+(\.\d+)*)/i):o.tizen&&(k=r(/tizen[\/\s](\d+(\.\d+)*)/i)),k&&(o.osversion=k);var S=!o.windows&&k.split(".")[0];return b||c||"ipad"==a||i&&(3==S||S>=4&&!w)||o.silk?o.tablet=e:(w||"iphone"==a||"ipod"==a||i||s||o.blackberry||o.webos||o.bada)&&(o.mobile=e),o.msedge||o.msie&&o.version>=10||o.yandexbrowser&&o.version>=15||o.vivaldi&&o.version>=1||o.chrome&&o.version>=20||o.samsungBrowser&&o.version>=4||o.firefox&&o.version>=20||o.safari&&o.version>=6||o.opera&&o.version>=10||o.ios&&o.osversion&&o.osversion.split(".")[0]>=6||o.blackberry&&o.version>=10.1||o.chromium&&o.version>=20?o.a=e:o.msie&&o.version<10||o.chrome&&o.version<20||o.firefox&&o.version<20||o.safari&&o.version<6||o.opera&&o.version<10||o.ios&&o.osversion&&o.osversion.split(".")[0]<6||o.chromium&&o.version<20?o.c=e:o.x=e,o}var r=t("undefined"!=typeof navigator&&navigator.userAgent||"");function n(e){return e.split(".").length}function o(e,t){var r,n=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(r=0;r<e.length;r++)n.push(t(e[r]));return n}function a(e){for(var t=Math.max(n(e[0]),n(e[1])),r=o(e,function(e){var r=t-n(e);return o((e+=new Array(r+1).join(".0")).split("."),function(e){return new Array(20-e.length).join("0")+e}).reverse()});--t>=0;){if(r[0][t]>r[1][t])return 1;if(r[0][t]!==r[1][t])return-1;if(0===t)return 0}}function i(e,n,o){var i=r;"string"==typeof n&&(o=n,n=void 0),void 0===n&&(n=!1),o&&(i=t(o));var s=""+i.version;for(var c in e)if(e.hasOwnProperty(c)&&i[c]){if("string"!=typeof e[c])throw new Error("Browser version in the minVersion map should be a string: "+c+": "+String(e));return a([s,e[c]])<0}return n}return r.test=function(e){for(var t=0;t<e.length;++t){var n=e[t];if("string"==typeof n&&n in r)return!0}return!1},r.isUnsupportedBrowser=i,r.compareVersions=a,r.check=function(e,t,r){return!i(e,t,r)},r._detect=t,r.detect=t,r},void 0!==t&&t.exports?t.exports=o():n.bowser=o()},{}],26:[function(e,t,r){(function(n){function o(){var e;try{e=r.storage.debug}catch(e){}return!e&&void 0!==n&&"env"in n&&(e=n.env.DEBUG),e}(r=t.exports=e("./debug")).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},r.formatArgs=function(e){var t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+r.humanize(this.diff),!t)return;var n="color: "+this.color;e.splice(1,0,n,"color: inherit");var o=0,a=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&"%c"===e&&(a=++o)}),e.splice(a,0,n)},r.save=function(e){try{null==e?r.storage.removeItem("debug"):r.storage.debug=e}catch(e){}},r.load=o,r.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},r.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),r.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],r.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},r.enable(o())}).call(this,e("_process"))},{"./debug":27,_process:30}],27:[function(e,t,r){function n(e){var t;function n(){if(n.enabled){var e=n,o=+new Date,a=o-(t||o);e.diff=a,e.prev=t,e.curr=o,t=o;for(var i=new Array(arguments.length),s=0;s<i.length;s++)i[s]=arguments[s];i[0]=r.coerce(i[0]),"string"!=typeof i[0]&&i.unshift("%O");var c=0;i[0]=i[0].replace(/%([a-zA-Z%])/g,function(t,n){if("%%"===t)return t;c++;var o=r.formatters[n];if("function"==typeof o){var a=i[c];t=o.call(e,a),i.splice(c,1),c--}return t}),r.formatArgs.call(e,i),(n.log||r.log||console.log.bind(console)).apply(e,i)}}return n.namespace=e,n.enabled=r.enabled(e),n.useColors=r.useColors(),n.color=function(e){var t,n=0;for(t in e)n=(n<<5)-n+e.charCodeAt(t),n|=0;return r.colors[Math.abs(n)%r.colors.length]}(e),n.destroy=o,"function"==typeof r.init&&r.init(n),r.instances.push(n),n}function o(){var e=r.instances.indexOf(this);return-1!==e&&(r.instances.splice(e,1),!0)}(r=t.exports=n.debug=n.default=n).coerce=function(e){return e instanceof Error?e.stack||e.message:e},r.disable=function(){r.enable("")},r.enable=function(e){var t;r.save(e),r.names=[],r.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),o=n.length;for(t=0;t<o;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$")));for(t=0;t<r.instances.length;t++){var a=r.instances[t];a.enabled=r.enabled(a.namespace)}},r.enabled=function(e){if("*"===e[e.length-1])return!0;var t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1},r.humanize=e("ms"),r.instances=[],r.names=[],r.skips=[],r.formatters={}},{ms:29}],28:[function(e,t,r){var n=Object.create||function(e){var t=function(){};return t.prototype=e,new t},o=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return r},a=Function.prototype.bind||function(e){var t=this;return function(){return t.apply(e,arguments)}};function i(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=n(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}t.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0;var s,c=10;try{var u={};Object.defineProperty&&Object.defineProperty(u,"x",{value:0}),s=0===u.x}catch(e){s=!1}function d(e){return void 0===e._maxListeners?i.defaultMaxListeners:e._maxListeners}function l(e,t,r,o){var a,i,s;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((i=e._events)?(i.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),i=e._events),s=i[t]):(i=e._events=n(null),e._eventsCount=0),s){if("function"==typeof s?s=i[t]=o?[r,s]:[s,r]:o?s.unshift(r):s.push(r),!s.warned&&(a=d(e))&&a>0&&s.length>a){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",c.name,c.message)}}else s=i[t]=r,++e._eventsCount;return e}function p(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function f(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},o=a.call(p,n);return o.listener=r,n.wrapFn=o,o}function m(e){var t=this._events;if(t){var r=t[e];if("function"==typeof r)return 1;if(r)return r.length}return 0}function h(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}s?Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||e!=e)throw new TypeError('"defaultMaxListeners" must be a positive number');c=e}}):i.defaultMaxListeners=c,i.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},i.prototype.getMaxListeners=function(){return d(this)},i.prototype.emit=function(e){var t,r,n,o,a,i,s="error"===e;if(i=this._events)s=s&&null==i.error;else if(!s)return!1;if(s){if(arguments.length>1&&(t=arguments[1]),t instanceof Error)throw t;var c=new Error('Unhandled "error" event. ('+t+")");throw c.context=t,c}if(!(r=i[e]))return!1;var u="function"==typeof r;switch(n=arguments.length){case 1:!function(e,t,r){if(t)e.call(r);else for(var n=e.length,o=h(e,n),a=0;a<n;++a)o[a].call(r)}(r,u,this);break;case 2:!function(e,t,r,n){if(t)e.call(r,n);else for(var o=e.length,a=h(e,o),i=0;i<o;++i)a[i].call(r,n)}(r,u,this,arguments[1]);break;case 3:!function(e,t,r,n,o){if(t)e.call(r,n,o);else for(var a=e.length,i=h(e,a),s=0;s<a;++s)i[s].call(r,n,o)}(r,u,this,arguments[1],arguments[2]);break;case 4:!function(e,t,r,n,o,a){if(t)e.call(r,n,o,a);else for(var i=e.length,s=h(e,i),c=0;c<i;++c)s[c].call(r,n,o,a)}(r,u,this,arguments[1],arguments[2],arguments[3]);break;default:for(o=new Array(n-1),a=1;a<n;a++)o[a-1]=arguments[a];!function(e,t,r,n){if(t)e.apply(r,n);else for(var o=e.length,a=h(e,o),i=0;i<o;++i)a[i].apply(r,n)}(r,u,this,o)}return!0},i.prototype.addListener=function(e,t){return l(this,e,t,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(e,t){return l(this,e,t,!0)},i.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,f(this,e,t)),this},i.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,f(this,e,t)),this},i.prototype.removeListener=function(e,t){var r,o,a,i,s;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(o=this._events))return this;if(!(r=o[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=n(null):(delete o[e],o.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(a=-1,i=r.length-1;i>=0;i--)if(r[i]===t||r[i].listener===t){s=r[i].listener,a=i;break}if(a<0)return this;0===a?r.shift():function(e,t){for(var r=t,n=r+1,o=e.length;n<o;r+=1,n+=1)e[r]=e[n];e.pop()}(r,a),1===r.length&&(o[e]=r[0]),o.removeListener&&this.emit("removeListener",e,s||t)}return this},i.prototype.removeAllListeners=function(e){var t,r,a;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=n(null),this._eventsCount=0):r[e]&&(0==--this._eventsCount?this._events=n(null):delete r[e]),this;if(0===arguments.length){var i,s=o(r);for(a=0;a<s.length;++a)"removeListener"!==(i=s[a])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=n(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(t)for(a=t.length-1;a>=0;a--)this.removeListener(e,t[a]);return this},i.prototype.listeners=function(e){var t,r=this._events;return r&&(t=r[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(t):[]},i.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},i.prototype.listenerCount=m,i.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],29:[function(e,t,r){var n=1e3,o=60*n,a=60*o,i=24*a,s=365.25*i;function c(e,t,r){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}t.exports=function(e,t){t=t||{};var r,u=typeof e;if("string"===u&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return r*s;case"days":case"day":case"d":return r*i;case"hours":case"hour":case"hrs":case"hr":case"h":return r*a;case"minutes":case"minute":case"mins":case"min":case"m":return r*o;case"seconds":case"second":case"secs":case"sec":case"s":return r*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}(e);if("number"===u&&!1===isNaN(e))return t.long?c(r=e,i,"day")||c(r,a,"hour")||c(r,o,"minute")||c(r,n,"second")||r+" ms":function(e){if(e>=i)return Math.round(e/i)+"d";if(e>=a)return Math.round(e/a)+"h";if(e>=o)return Math.round(e/o)+"m";if(e>=n)return Math.round(e/n)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},{}],30:[function(e,t,r){var n,o,a=t.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function c(e){if(n===setTimeout)return setTimeout(e,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:i}catch(e){n=i}try{o="function"==typeof clearTimeout?clearTimeout:s}catch(e){o=s}}();var u,d=[],l=!1,p=-1;function f(){l&&u&&(l=!1,u.length?d=u.concat(d):p=-1,d.length&&m())}function m(){if(!l){var e=c(f);l=!0;for(var t=d.length;t;){for(u=d,d=[];++p<t;)u&&u[p].run();p=-1,t=d.length}u=null,l=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===s||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(e);try{o(e)}catch(t){try{return o.call(null,e)}catch(t){return o.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function v(){}a.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];d.push(new h(e,t)),1!==d.length||l||c(m)},h.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=v,a.addListener=v,a.once=v,a.off=v,a.removeListener=v,a.removeAllListeners=v,a.emit=v,a.prependListener=v,a.prependOnceListener=v,a.listeners=function(e){return[]},a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},{}],31:[function(e,t,r){!function(e){function r(e){var t=(e=e||{}).min,r=e.max,n=e.integer||!1;if(null==t&&null==r?(t=0,r=1):null==t?t=r-1:null==r&&(r=t+1),r<t)throw new Error("invalid options, max must be >= min");return{min:t,max:r,integer:n}}function n(e){if((e=r(e)).max===e.min)return e.min;var t=Math.random()*(e.max-e.min+Number(!!e.integer))+e.min;return e.integer?Math.floor(t):t}t.exports=n,t.exports.generator=function(e){return e=r(e),function(t,r,o){return e.min=null!=t?t:e.min,e.max=null!=r?r:e.max,e.integer=null!=o?o:e.integer,n(e)}},t.exports.defaults=r}()},{}],32:[function(e,t,r){var n=t.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))? (\S*)(?: (\S*))?/,names:["value","direction","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+" %s"+(e.config?" %s":"")}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{push:"invalid",names:["value"]}]};Object.keys(n).forEach(function(e){n[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},{}],33:[function(e,t,r){var n=e("./parser"),o=e("./writer");r.write=o,r.parse=n.parse,r.parseFmtpConfig=n.parseFmtpConfig,r.parseParams=n.parseParams,r.parsePayloads=n.parsePayloads,r.parseRemoteCandidates=n.parseRemoteCandidates,r.parseImageAttributes=n.parseImageAttributes,r.parseSimulcastStreamList=n.parseSimulcastStreamList},{"./parser":34,"./writer":35}],34:[function(e,t,r){var n=function(e){return String(Number(e))===e?Number(e):e},o=function(e,t,r){var o=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:o&&!t[e.name]&&(t[e.name]={});var a=e.push?{}:o?t[e.name]:t;!function(e,t,r,o){if(o&&!r)t[o]=n(e[1]);else for(var a=0;a<r.length;a+=1)null!=e[a+1]&&(t[r[a]]=n(e[a+1]))}(r.match(e.reg),a,e.names,e.name),e.push&&t[e.push].push(a)},a=e("./grammar"),i=RegExp.prototype.test.bind(/^([a-z])=(.*)/);r.parse=function(e){var t={},r=[],n=t;return e.split(/(\r\n|\r|\n)/).filter(i).forEach(function(e){var t=e[0],i=e.slice(2);"m"===t&&(r.push({rtp:[],fmtp:[]}),n=r[r.length-1]);for(var s=0;s<(a[t]||[]).length;s+=1){var c=a[t][s];if(c.reg.test(i))return o(c,n,i)}}),t.media=r,t};var s=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length&&(e[r[0]]=n(r[1])),e};r.parseParams=function(e){return e.split(/\;\s?/).reduce(s,{})},r.parseFmtpConfig=r.parseParams,r.parsePayloads=function(e){return e.split(" ").map(Number)},r.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(n),o=0;o<r.length;o+=3)t.push({component:r[o],ip:r[o+1],port:r[o+2]});return t},r.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(s,{})})},r.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,r=!1;return"~"!==e[0]?t=n(e):(t=n(e.substring(1,e.length)),r=!0),{scid:t,paused:r}})})}},{"./grammar":32}],35:[function(e,t,r){var n=e("./grammar"),o=/%[sdv%]/g,a=function(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var a=0;a<t.names.length;a+=1){var i=t.names[a];t.name?n.push(r[t.name][i]):n.push(r[t.names[a]])}else n.push(r[t.name]);return function(e){var t=1,r=arguments,n=r.length;return e.replace(o,function(e){if(t>=n)return e;var o=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(o);case"%d":return Number(o);case"%v":return""}})}.apply(null,n)},i=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s=["i","c","b","a"];t.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var r=t.outerOrder||i,o=t.innerOrder||s,c=[];return r.forEach(function(t){n[t].forEach(function(r){r.name in e&&null!=e[r.name]?c.push(a(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach(function(e){c.push(a(t,r,e))})})}),e.media.forEach(function(e){c.push(a("m",n.m[0],e)),o.forEach(function(t){n[t].forEach(function(r){r.name in e&&null!=e[r.name]?c.push(a(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach(function(e){c.push(a(t,r,e))})})})}),c.join("\r\n")+"\r\n"}},{"./grammar":32}]},{},[22])(22)});